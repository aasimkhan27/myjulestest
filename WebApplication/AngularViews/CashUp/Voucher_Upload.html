<style>
    #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 12px;
        height: 12px;
        margin: -76px 0 0 -76px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
<div class="card-header">
    <h5 class="card-title">Upload Voucher</h5>
    <div class="card-tools">
        <ul class="nav nav-pills ml-auto">
            <li class="nav-item mr-1"><a class="btn btn-wenodo text-white" ng-click="REDIRECTION_PAGE('CV');">Back</a></li>
            <li><label><a href="{{DOWNLOAD_FILE_PATH}}" id="btn" class="btn btn-w-default" download="" title="Download Template Excel file" target="_blank"><i class="fa fa-download"></i> Download Template </a></label></li>&nbsp;
        </ul>
    </div>
</div>
<div class="card-body">
    <form id="UploadepositForm" name="UploadepositForm" novalidate>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label>Branch</label>
                    <select name="BRANCH" class="custom-select"
                            ng-options="BRL.BRANCH_ID as BRL.BRANCH_NAME for BRL in BRANCH_LIST"
                            ng-model="VoucherSearch.BRANCH_ID"></select>
                </div>
            </div>
            <div class="col-md-3">
                <label>Upload File:*</label>
                <div class="input-group">
                    <input class="form-control text-xs" type="file"
                           ng-model="VoucherSearch.UploadedFiles"
                           id="uploadExcel1"
                           ng-files="Refreshdata();getTheFilesToUploadall($files,5,VoucherSearch,1, 'uploadExcel','VOUCHER')"
                           ng-click="FILEUPLOADCLICK()"
                           name="file" />

                    <div class="input-group-append">
                        <span class="input-group-text" ng-if="Uploading">
                            <img src="../../E_Content/images/loading.gif" style="height: 22px" />
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-auto">
                <div class="form-group">
                    <label class="d-block">&nbsp;</label>
                    <button type="button" value="Validate" ng-disabled="VoucherSearch.UploadedFiles==null" ng-click="EXCEL_VOUCHER_VALIDATE();" class="btn btn-wenodo" data-toggle="tooltip" data-html="true" data-original-title="Validate">
                        <i class="far fa-badge-check"></i>
                    </button>
                    <button type="button" ng-click="RESET_UPLOAD()" class="btn btn-w-default" data-toggle="tooltip" data-html="true" data-original-title="Reset">
                        <i class="far fa-undo"></i>
                    </button>
                    <button type="button" value="Upload" ng-disabled="INVALID_EXCLE_CELL_COUNT>0" ng-click="UPLOAD_VOUCHERS()" class="btn btn-wenodo" data-toggle="tooltip" data-html="true" data-original-title="Submit" disabled="disabled">
                        <i class="far fa-save"></i>
                    </button>
                    <button type="button" ng-show="submitted" class="btn {{INVALID_EXCLE_CELL_COUNT==0?'btn-wenodo':'btn-danger'}} " data-toggle="modal" data-target="#View_Report">
                        <i ng-show="INVALID_EXCLE_CELL_COUNT>0" class="far fa-exclamation-triangle"></i>  <i class="far fa-eye" data-toggle="tooltip" data-html="true" data-original-title="View"></i>
                    </button>
                </div>
            </div>
            <!--<div class="col-md-12">
                <div class="form-group">
                    <button ng-click="INS_UPD_DEPOSITE_HEADER();" class="btn btn-wenodo">Save</button>
                </div>
            </div>-->
        </div>
    </form>
</div>
<div class="card-header">
    <h5 class="card-title">Filter By</h5>
</div>
<div class="card-body">
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label>User Name:</label>
                <input type="text"
                       class="form-control"
                       autocomplete="off"
                       maxlength="250"
                       name="USER_NAME" placeholder="Enter Username or Email Id"
                       ng-model="VoucherSearch.USER_NAME" />
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label>Branch:</label>
                <select class="custom-select"
                        name="BRANCH_ID"
                        ng-model="VoucherSearch.BRANCH_ID_FILTER"
                        ng-options="CL.BRANCH_ID as CL.BRANCH_NAME for CL in BRANCH_LIST">
                    <option value="">- Please Select Branch-</option>
                </select>
            </div>
        </div>
        <!--<div class="col-md-3">
            <div class="form-group">
                <label>Upload Date:</label>
                <div id="reportrange" class="custom-select custom-date text-xs">
                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                    <span></span><b class="caret"></b>
                </div>
            </div>
        </div>-->

        <div class="col">
            <div class="form-group">
                <label>File Name:</label>
                <input type="text" placeholder="Enter File Name"
                       class="form-control"
                       maxlength="250"
                       name="FILE_NAME"
                       ng-model="VoucherSearch.ORIGINAL_FILE_NAME" />
            </div>
        </div>
        <div class="col-auto">
            <div class="row">
                <div class="form-group">
                    <label class="d-block">&nbsp;</label>
                    <button click-once ng-click="GET_VOUCHER_LOG_HDR()" class="btn btn-wenodo" data-toggle="tooltip" data-html="true" data-original-title="Search"><i class="far fa-search"></i></button>
                    <button ng-click="RESET_FILTER()" class="btn btn-w-default" data-toggle="tooltip" data-html="true" data-original-title="Reset"><i class="far fa-undo"></i></button>
                </div>
            </div>
        </div>

    </div>
</div>
<div class="text-center" ng-show="VOUCHER_LOG_HDR_DETAILS.length==0" empty-grid>
</div>
<div class="table-responsive custom-scrollbar height-450" ng-show="VOUCHER_LOG_HDR_DETAILS.length>0">
    <table class="table table-hover table-striped table-head-fixed">
        <thead class="bg-wenodo-dark-blue">
            <tr>
                <th>User Name</th>
                <th>Entity</th>
                <th class="text-nowrap">Branch Name</th>
                <th>File Name</th>
                <th class="text-nowrap">Total Records</th>
                <th class="text-nowrap">Upload Date</th>
                <!--<th>Is Live</th>
            <th>Status</th>-->
                <th>View</th>
            </tr>
        </thead>

        <tbody ng-repeat="CL in VOUCHER_LOG_HDR_DETAILS" on-finish-render="ngRepeatFinished">
            <tr>
                <td>
                    {{CL.USER_NAME}}
                    <br />
                    {{CL.USER_EMAIL}}
                </td>
                <td>{{CL.ENTITY_NAME}}</td>
                <td>{{CL.BRANCH_NAME}}</td>
                <td class="file_name_Limit text-nowrap" style="width:300px;"> <a download="{{CL.SERVER_FILE_NAME}}" href="{{CL.SERVER_FILE_NAME}}"> {{CL.ORIGINAL_FILE_NAME}}</a></td>
                <!--<td><a href="{{CL.SERVER_FILE_NAME}}" download>{{CL.ORIGINAL_FILE_NAME}}</a></td>-->
                <td>{{CL.VOUCHER_HRD_COUNT}}</td>
                <td class="text-nowrap">{{CL.CREATED_DATE | date:'MMM dd, yyyy'}}</td>
                <td class="headcol-right">
                    <a ng-click="GET_VOUCHER_LOG_DTL(CL)" data-toggle="modal" data-target="#View_Voucher_Log_Detail" data-html="true" data-original-title="View"><i class="fad fa-eye fa-lg text-green"></i></a>
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="8" class="text-center table-footer-fixed" ng-show="GetData">
                    <a class="btn btn-secondary text-white" click-once ng-click="LAZY_VOUCHER_LOG_HDR_DETAILS()">{{VIEWMORERECORD}}</a>
                    <!--<div id="loader"></div>-->
                    <!--<div class="overlay_loadingNew" style="display:{{overlay_loadingNew}}!important"></div>-->    
                </td>
            </tr>
        </tfoot>
    </table>
</div>

<div class="modal fade" id="View_Report" aria-modal="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> Your Uploaded File</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body custom-scrollbar height-500">
                <div class="text-center" ng-show="VOUCHER_VALIDATE_LIST.length==0" empty-grid></div>
                <div class="col-md-12">
                    <div data-ng-show="INVALID_EXCLE_CELL_FLAG" class="form-group has-error errormessage badge badge-light-red w-100 p-3">
                        <span class="help-block errormessageline"><i class="fa fa-exclamation-triangle"></i> - Please provide the mandatory details to (marked in red).</span>
                    </div>
                    <div id="divInvlidUser" class="hideshowdiv" data-ng-show="INVALID_EXCLE_CELL_FLAG">
                        <span class="help-block">{{InvalidUser}}</span>
                    </div>
                    <div class="form-group has-error errormessage badge badge-light-red w-100 p-3" ng-repeat="CD in CODE_ARRY | unique:'CODE' ">
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='CODE0003'"><i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Invalid Hyperlink: Malformed URI is embedded as a hyperlink in the document.please remove hyperlink.</span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='CHECK0003'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Please provide True or False.
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='EMAIL0009'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Invalid Email.
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0010'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Number Only.
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0011'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Number/Digit Only.
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0012'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Negative value should not allow.
                        </span>

                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='DATE0007'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Please provide 'MM/DD/YYYY' format,example:'01/01/1999'.
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='TIME0006'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} -Invalid Time Format.
                        </span>
                    </div>
                </div>
                <div class="table-responsive" ng-show="VOUCHER_VALIDATE_LIST.length>0">
                    <table class="table table-striped">
                        <tr>
                            <th ng-repeat="(key, value) in VOUCHER_VALIDATE_LIST[0]">{{key}}</th>
                        </tr>
                        <tbody ng-repeat="ex in VOUCHER_VALIDATE_LIST" on-finish-render="ngRepeatFinishedRender">
                            <tr>
                                <td ng-repeat="(key, value) in ex" ng-class="{'border-red':obj.IS_DATA_VALID}" ng-init="obj= ngintvalidationvalue(key,value)">
                                    <span ng-show="false">
                                        {{value}}
                                    </span>
                                    <span ng-class="{'border-red':obj.IS_VALID}">
                                        <span ng-show="obj.IS_VALID"><i class="fa fa-exclamation-triangle text-danger"></i></span>
                                        {{
obj.DISPLAY_TEXT
                                        }}
                                    </span>
                                    <span ng-show="obj.IS_DATA_VALID">
                                        {{obj.CODE}}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="View_Voucher_Log_Detail" aria-modal="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    Your Uploaded File ({{COVERS_LINE.ORIGINAL_FILE_NAME}})
                </h4>
                <h6 class="ml-auto mb-0 semibold text-secondary">Total Records- {{COVERS_LINE.VOUCHER_HRD_COUNT}}</h6>
                <button type="button" class="close m-0 py-0" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body height-535">
                <div class="table-responsive custom-scrollbar height-500" ng-show="VOUCHER_LOG_DETAILS.length>0">
                    <table class="table table-striped table-head-fixed">
                        <thead class="bg-wenodo-dark-blue">
                            <tr>
                                <th class="text-nowrap">S.No</th>
                                <th class="text-nowrap">Invoice</th>
                                 <th class="text-nowrap">Voucher Type</th>
                                <th class="text-nowrap">Voucher # </th>
                                <th class="text-nowrap">Amount</th>
                                <th> Date</th>
                                <th class="text-nowrap">Payment Method</th>
                                <th class="text-nowrap">Sold To</th>
                                <th class="text-nowrap">Note</th>
                                <th class="text-nowrap">Status</th>
                                <th class="text-nowrap">Comments</th>
                                <th class="text-nowrap">Created Date</th>

                                <!--<th class="text-nowrap">Redeem Status</th>
                                <th class="text-nowrap">Cancel Status</th>
                                <th class="text-nowrap">Rejection Status</th>-->
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <td colspan="8" align="center" ng-show="GetDataDTL">
                                    <a class="btn btn-secondary text-white" click-once ng-click="LAZY_VOUCHER_LOG_DETAILS(COVERS_LINE)">{{VIEWMORERECORD}}</a>
                                </td>
                            </tr>
                        </tfoot>
                        <tbody ng-repeat="CL in VOUCHER_LOG_DETAILS" on-finish-render="ngRepeatFinished">
                            <tr>
                                <td>{{$index+1}}</td>
                                <td>{{CL.INVOICE}}</td>
                                 <td>{{CL.VOUCHER_TYPE}}</td>
                                 <td>{{CL.VOUCHER}}</td>
                                 <td>{{CL.VOUCHER_AMOUNT}}</td>
                                 <td>{{CL.VOUCHER_DATE|date}}</td>
                                <td>{{CL.PAYMENT_METHOD}}</td>
                                <td>{{CL.SOLD_TO}}</td>
                                <!--<td>{{CL.COVER_COUNT}}</td>-->
                                <td>{{CL.NOTE }}</td>
                                <td><span ng-show="CL.IS_REJECTED==true">Rejected </span><span ng-show="CL.IS_REJECTED==false"> </span></td>
                                <td>{{CL.COMMENTS}}</td>
                                <td>{{CL.CREATED_DATE|date}}</td>
                                <!--<td>{{CL.IS_REDEEM==true?'Yes':'No' }}</td>
                                <td>{{CL.IS_CANCELLED==true?'Cancel':'' }}</td>
                                <td>{{CL.IS_REJECTED==true?'Rejected':'' }}</td>-->
                            </tr>
                        </tbody>
                        <!--<tfoot>
                            <tr>
                                <td colspan="5"></td>
                                <td>Total </td>
                                <td>{{DEPOSIT_LOG_DETAILS |  total : 'COVER_COUNT'}}</td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tfoot>-->
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
