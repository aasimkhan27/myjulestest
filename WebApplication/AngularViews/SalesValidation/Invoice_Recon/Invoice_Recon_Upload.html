<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="process-wrapper">
                <div class="row">
                    <templateurl class="w-100" template-url="../AngularViews/SalesValidation/Invoice_Recon/InvRec_Header.html?v=4{{AppVersion}}">
                </div>
                <div id="progress-InvRec-Reconcile-section">
                    <div class="section-content Upload_Section active">
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label>Branch Name *</label>
                                    <select class="custom-select custom-select-sm"
                                            name="BRANCH_ID"
                                            ng-model="Inv_recon_Search.BRANCH_ID"
                                            ng-options="CL.BRANCH_ID as CL.BRANCH_NAME for CL in BRANCH_LIST"></select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label>Integration System *</label>
                                    <select class="custom-select custom-select-sm"
                                            name="BRANCH_ID"
                                            ng-model="Inv_recon_Search.INTEGRATION_SYSTEM_ID"
                                            ng-options="CL.INTEGRATION_SYSTEM_ID as CL.NAME for CL in INTEGRATION_SYSTEM_LIST"></select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="d-block">From / To Date *</label>
                                    <div id="reportrange" class="custom-select custom-select-sm pt-2" ng-class="{'error':ERROR_LIST.length>0}">
                                        <i class="fa fa-calendar-alt"></i>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <form class="form-container" enctype='multipart/form-data'>
                            <div class="upload-files-container">
                                <div class="row w-100">
                                    <div class="col">
                                        <div class="drag-file-area">
                                            <h3 class="dynamic-message"> Drag & drop your file below </h3>
                                            <label class="label">
                                                <span class="browse-files">
                                                    <span class="bg-light-grey d-block border-radius-3">
                                                        <input type="file"
                                                               id="Inv_recorduploadExcel1"
                                                               class="w-100 default-file-input"
                                                               ng-model="Inv_recon_Search.UploadedFiles"
                                                               ng-files="getTheFilesToUploadall($files,5,Inv_recon_Search,1, 'Inv_recorduploadExcel','INV_RECON',Inv_recon_Search.UPLOADE_TYPE_ID)"
                                                               name="file" />
                                                    </span>
                                                    <span class="browse-files-text">or <i class="far fa-upload"></i> browse file</span>
                                                    <span>from device</span>
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-auto" ng-show="ERROR_LIST.length>0">
                                        <ul class="bullets upload-errors">
                                            <!--<li class="text-danger" ng-repeat="DINC in ERROR_LIST">{{DINC.Message}}</li>-->
                                            <li class="text-danger" ng-show="ERROR_LIST.length>0 ">Selected from / to date is not matching from the file, please select date </li>
                                            <li class="text-danger" ng-show="Inv_recon_Search.MIN_DATE!='' && ERROR_LIST.length>0 ">Match from Date:-{{Inv_recon_Search.MIN_DATE | date}}</li>
                                            <li class="text-danger" ng-show="Inv_recon_Search.MAX_DATE!='' && ERROR_LIST.length>0">Match to Date:-{{Inv_recon_Search.MAX_DATE | date}}</li>
                                        </ul>
                                    </div>
                                </div>


                                <div class="file-block" ng-show="Inv_recon_Search.UploadedFiles[0].ORIGINAL_FILE_NAME!=null">
                                    <div class="file-info">
                                        <i class="far fa-file-alt file-icon"></i>
                                        <span class="file-name">{{Inv_recon_Search.UploadedFiles[0].ORIGINAL_FILE_NAME}} </span>
                                    </div>
                                </div>
                                <button type="button" ng-click="RESET_RECO_UPLOAD()" class="file-upload"> Reset </button>
                            </div>
                        </form>
                        <div class="col-md-12" ng-show="ERROR_LIST.length>0 && Inv_recon_Search.UploadedFiles.length>0">
                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-head-fixed compact_table">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>from Date</th>
                                            <th>To Date</th>
                                            <th>File Name</th>
                                            <th width="20%" class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td ng-class="{'text-danger':Inv_recon_Search.MIN_DATE!='' && ERROR_LIST.length>0}">
                                                <i class="far fa-calendar-alt text-blue"></i>
                                                {{Inv_recon_Search.FROM_DATE  | date}}
                                            </td>
                                            <td ng-class="{'text-danger':Inv_recon_Search.MAX_DATE!='' && ERROR_LIST.length>0}">
                                                <i class="far fa-calendar-alt text-blue"></i> {{Inv_recon_Search.TO_DATE | date}}
                                            </td>
                                            <td>
                                                {{Inv_recon_Search.UploadedFiles[0].ORIGINAL_FILE_NAME}}
                                            </td>
                                            <td class="text-center">
                                                <button ng-click="INS_INV_RECO_UPLOAD()"
                                                        type="button"
                                                        ng-show="false"
                                                        class="btn btn-sm btn-wenodo text-nowrap">
                                                    Upload
                                                </button>
                                                <button ng-show="Inv_recon_Search.STEP_NO==1"
                                                        ng-click="INS_INV_RECO_UPLOAD(1)"
                                                        type="button"
                                                        class="btn btn-sm btn-wenodo text-nowrap">
                                                    Upload & Process Data
                                                </button>
                                                <!--<button ng-show="Inv_recon_Search.STEP_NO<4"
                                                        ng-click="DISCARD_INV_RECO_UPLOAD(INC)"
                                                        type="button"
                                                        class="btn btn-sm btn-danger text-nowrap">
                                                    Discard
                                                </button>-->
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="table-responsive">
                                <div class="text-center" ng-show="INV_RECO_UPLOAD_HEADER_BY_ID_LIST.length==0 && ERROR_LIST.length==0" empty-grid></div>
                                <table class="table table-hover table-striped table-head-fixed compact_table" ng-show="INV_RECO_UPLOAD_HEADER_BY_ID_LIST.length>0">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>Uploaded by</th>
                                            <th>Uploaded Date</th>
                                            <th>Entity</th>
                                            <th>Branch</th>
                                            <th width="20%" class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="INC in INV_RECO_UPLOAD_HEADER_BY_ID_LIST">
                                        <tr>
                                            <td>{{INC.EMAIL}}</td>
                                            <td><i class="far fa-calendar-alt text-blue"></i> {{INC.CREATED_DATE | date}}</td>
                                            <td>{{INC.ENTITY_NAME}}</td>
                                            <td>{{INC.BRANCH_NAME}}</td>
                                            <td class="text-center">

                                                <button ng-show="Inv_recon_Search.STEP_NO==1"
                                                        ng-click="PROCESS_INV_RECO_CONTACT_MAPPING(INC)"
                                                        type="button"
                                                        class="btn btn-sm btn-wenodo text-nowrap">
                                                    Process Data
                                                </button>
                                                <button ng-show="Inv_recon_Search.STEP_NO<4"
                                                        ng-click="DISCARD_INV_RECO_UPLOAD(INC)"
                                                        type="button"
                                                        class="btn btn-sm btn-danger text-nowrap">
                                                    Discard
                                                </button>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-12 text-right">
                            <div class="form-group mt-4">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="View_Report" aria-modal="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> Your Uploaded File</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 mt-2">
                    <div class="notice d-flex bg-light-danger rounded border-warning border border-dashed mb-9 p-6" ng-repeat="CD in COPY_CODE_ARRY | unique:'CODE' ">
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='BLANK'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}}-Please provide necessary details or remove space from empty cell.
                            <span ng-repeat="BLN in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{BLN.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='CHECK0003'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Please provide True or False.
                            <span ng-repeat="BOL in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{BOL.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0010'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}}  - Number Only.
                            <span ng-repeat="NUMO in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NUMO.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0011'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Number/Digit Only.
                            <span ng-repeat="NUM in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NUM.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0012'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}} - Negative value should not allow.
                            <span ng-repeat="NTC in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NTC.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='DATE0007'">
                            <i class="fa fa-exclamation-triangle"></i> {{CD.CODE}}- Please provide 'MM/DD/YYYY' format,example:'01/01/1999'.
                            <span ng-repeat="DAT in COPY_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{DAT.POSITION}} </span>
                        </span>
                    </div>
                    <span class="help-block errormessageline" style="padding-left:0px;" ng-if="DUPLICATES.length>0">
                        <i class="fa fa-exclamation-triangle"></i> -Duplicate record found to excel.
                    </span>
                </div>


                <h2 ng-show="INVALID_INVOICE_CONTACT_LIST.length==0" class="heading-text-2">No records found to upload.</h2>
                <table class="table table-striped">
                    <tr>
                        <th ng-repeat="(key, value) in INVALID_INVOICE_CONTACT_LIST[0]" ng-show="key!='ROW_INDEX'">{{key}}</th>
                    </tr>
                    <tbody ng-repeat="ex in INVALID_INVOICE_CONTACT_LIST" on-finish-render="ngRepeatFinishedRender">
                        <tr>
                            <td ng-repeat="(key, value) in ex" ng-show="key!='ROW_INDEX'" ng-class="{'border-red':obj.IS_DATA_VALID}" ng-init="obj= ngintvalidationvalue(key,value)">
                                <span ng-show="false">{{value}}</span>
                                <span ng-class="{'border-red':obj.IS_VALID}">
                                    <span ng-show="obj.IS_VALID"><i class="fa fa-exclamation-triangle text-danger"></i></span>
                                    {{obj.DISPLAY_TEXT}}
                                </span>
                                <span ng-show="obj.IS_DATA_VALID">
                                    {{obj.CODE}}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
