<div class="overlay_loadingNew" id="overlay_loadingNew" style="display:{{overlay_loadingNew}}!important"></div>

<div class="card-header">
    <h5 class="heading-text-2">Upload Budget</h5>
    <div class="card-tools">
        <ul class="nav nav-pills ml-auto">
            <li class="nav-item">
                <a class="btn btn-wenodo" ng-click="REDIRECTION_PAGE('Budget_Index',CHECK_MODULE_ACCESS(52,5));">Back</a>
            </li>
        </ul>
    </div>
</div>
<form id="BudgetForm" name="BudgetForm" novalidate ng-init="GET_BRANCH_BUDGET_LOGS();">
    <div class="card-header">
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label>Entity:</label>
                    <select class="custom-select"
                            name="ENTITY_ID"
                            ng-model="BudgetSearch.ENTITY_ID"
                            ng-options="EL.ENTITY_ID as EL.ENTITY_NAME for EL in ENTITY_LIST"
                            ng-change="ADMIN_GET_BRANCH();"
                            ng-class="{'error':BudgetForm.submitted && BudgetForm.ENTITY_ID.$error.required}">
                        <option value="">- Please Select Entity-</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Branch:</label>
                    <select class="custom-select"
                            name="BRANCH_ID"
                            ng-model="BudgetSearch.BRANCH_ID"
                            ng-options="CL.BRANCH_ID as CL.BRANCH_NAME for CL in BRANCH_LIST"
                            ng-class="{'error':BudgetForm.submitted && BudgetForm.BRANCH_ID.$error.required}">
                        <option value="">- Please Select Branch-</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4" ng-init="$parent.dateinputOpenDate()">
                <div class="form-group">
                    <label>Start Date:</label>
                    <input type="text"
                           class="form-control dateinputOpenDate"
                           autocomplete="off"
                           name="ReportSearch.START_DATE"
                           readonly
                           placeholder="Select ..."
                           ng-model="BudgetSearch.START_DATE"
                           ng-value="BudgetSearch.START_DATE | date"
                           ng-class="{'error':BudgetForm.submitted && BudgetForm.START_DATE.$error.required}" />
                </div>
            </div>
            <div class="col-md-4">
                <label class="d-block">End Date:</label>
                <input type="text"
                       class="form-control dateinputOpenDate"
                       autocomplete="off"
                       name="ReportSearch.END_DATE"
                       readonly
                       placeholder="Select ..."
                       ng-model="BudgetSearch.END_DATE"
                       ng-value="BudgetSearch.END_DATE | date"
                       ng-class="{'error':BudgetForm.submitted && BudgetForm.END_DATE.$error.required}" />
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>File Name:</label>
                    <input type="text"
                           class="form-control"
                           maxlength="250"
                           name="FILE_NAME"
                           ng-model="BudgetSearch.FILE_NAME"
                           ng-class="{'error':BudgetForm.submitted && BudgetForm.FILE_NAME.$error.required}" />

                </div>
            </div>
            <div class="col-md-4">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="d-block">Upload Budget</label>
                            <a class="btn btn-transparent text-blue" data-toggle="modal" data-target="#UPLOAD_POPUP_Report" data-html="true" data-original-title="View">
                                <i class="far fa-upload"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="d-block">Download Template</label>
                            <!--<a  data-toggle="modal" data-target="#UPLOAD_POPUP_Report" data-html="true" data-original-title="View">
                                <i class="far fa-upload"></i>
                            </a>-->
                            <a href="{{DOWNLOAD_FILE_PATH}}" id="btn" class="btn btn-transparent text-blue" download="" title="Download Sample Excel file" target="_blank">
                                <i class="far fa-download"></i>{{DOWNLOAD_REPORT_NAME}}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div data-ng-show="LocForm.submitted && LocForm.$invalid" class="form-group has-error errormessage badge badge-light-red w-100 p-3">
                <span class="help-block errormessageline"><i class="fa fa-exclamation-triangle"></i> - Please provide the mandatory details to submit(marked in red).</span>
            </div>
            <div id="divInvlidUser" class="hideshowdiv" data-ng-show="LocForm.$valid">
                <span class="help-block">{{InvalidUser}}</span>
            </div>
        </div>
        <div class="col-md-12">
            <div class="row">
                <div class="form-group">
                    <button ng-click="GET_BRANCH_BUDGET_LOGS(1)" class="btn btn-wenodo">Search</button>
                    <button ng-click="RESET()" class="btn btn-w-default">Reset</button>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="card-body mb-0">
    <div class="text-center" ng-show="BRANCH_BUDGET_LOGS.length==0" empty-grid>
    </div>
    <div class="table-responsive custom-scrollbar height-450" ng-show="BRANCH_BUDGET_LOGS.length>0">
        <table class="table table-striped table-head-fixed">
            <thead class="bg-wenodo-dark-blue">
                <tr>
                    <th>Entity</th>
                    <th>Branch Name</th>
                    <th>File Name</th>
                    <th>Total Insert Count</th>
                    <th>Total Updated</th>
                    <th>Error Count</th>
                    <th>Uploaded Date</th>
                    <!--<th>Is Live</th>
                    <th>Status</th>-->
                    <th>View</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <td colspan="8" align="center" ng-show="GetData">
                        <a class="btn btn-secondary text-white" ng-click="LAZY_GET_BRANCH_BUDGET_LOGS()">{{VIEWMORERECORD}}</a>
                    </td>
                </tr>
            </tfoot>
            <tbody ng-repeat="CL in BRANCH_BUDGET_LOGS" on-finish-render="ngRepeatFinished">
                <tr>
                    <td>{{CL.ENTITY_NAME}}</td>
                    <td>{{CL.BRANCH_NAME}}</td>
                    <td>{{CL.FILE_NAME}}</td>
                    <td>{{CL.INSERT_COUNT}}</td>
                    <td>{{CL.UPDATE_COUNT}}</td>
                    <td>{{CL.ERROR_COUNT}}</td>
                    <td>{{CL.UPLOAD_DATE | date}}</td>
                    <td class="headcol-right">
                        <a ng-click="GET_BRANCH_BUDGET_LOG_DETAILS(CL,1)" data-toggle="modal" data-target="#View_Budget_Log_Detail" data-html="true" data-original-title="View"><i class="fad fa-eye fa-lg text-green"></i></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<form id="BudgetFormUpload" name="BudgetFormUpload" novalidate>
    <div class="modal fade" id="UPLOAD_POPUP_Report" aria-modal="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Upload Budget Excel File</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body custom-scrollbar height-450">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Entity:*</label>
                                <select class="custom-select"
                                        name="ENTITY_ID_UPLOAD"
                                        required
                                        ng-model="BudgetSearch.ENTITY_ID_UPLOAD"
                                        ng-options="EL.ENTITY_ID as EL.ENTITY_NAME for EL in ENTITY_LIST"
                                        ng-change="ADMIN_GET_BRANCH(1);"
                                        ng-class="{'error':BudgetFormUpload.submitted && BudgetFormUpload.ENTITY_ID_UPLOAD.$error.required}">
                                    <option value="">- Please Select Entity-</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Branch:*</label>
                                <select class="custom-select"
                                        name="BRANCH_ID_UPLOAD"
                                        required
                                        ng-model="BudgetSearch.BRANCH_ID_UPLOAD"
                                        ng-options="CL.BRANCH_ID as CL.BRANCH_NAME for CL in BRANCH_LIST_VIEW"
                                        ng-class="{'error':BudgetFormUpload.submitted && BudgetFormUpload.BRANCH_ID_UPLOAD.$error.required}">
                                    <option value="">- Please Select Branch-</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label>Upload File:*</label>
                            <div class="input-group">
                                <input class="form-control text-xs" type="file"
                                       ng-model="BudgetSearch.UploadedFiles"
                                       id="uploadExcel1" ng-files="getTheFilesToUploadall($files,5,BudgetSearch,1, 'uploadExcel','BUDGET')"
                                       ng-click="RESET_BUTTON_SETUP();"
                                       name="file" />

                                <div class="input-group-append">
                                    <span class="input-group-text" ng-if="Uploading">
                                        <img src="../../E_Content/images/loading.gif" style="height: 22px" />
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="form-group">
                        <button type="button" value="Validate"
                                ng-click="EXCEL_BUDGET_ADD()"
                                class="btn btn-wenodo">
                            Validate
                        </button>

                        <button type="button" value="Upload"
                                ng-disabled="BUDGET_INVALID_EXCLE_CELL_FLAG"
                                ng-click="BUDGET_UPLOAD()"
                                class="btn btn-wenodo">
                            Upload
                        </button>
                        <button class="btn btn-w-default" type="button" data-toggle="modal" data-target="#View_Report" ng-if="BUDGET_INVALID_EXCLE_CELL_COUNT !=null && BUDGET_INVALID_EXCLE_CELL_COUNT==0 && BRANCH_BUDGETS.length>0">
                            <i class="far fa-eye"></i> View
                        </button>

                        <button class="btn btn-danger" ng-if="BUDGET_INVALID_EXCLE_CELL_COUNT>0" data-toggle="modal" data-target="#View_Report">
                            <i class="far fa-exclamation-triangle"></i> Validation Failed
                        </button>
                        <button ng-click="RESET()" class="btn btn-w-default">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="modal fade" id="View_Report" aria-modal="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> Your Uploaded File</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <h2 ng-show="BRANCH_BUDGETS.length==0" class="heading-text-2">No records found to upload.</h2>
                <div class="col-md-12 mb-2">
                    <div class="notice d-flex rounded border-warning border border-dashed mb-9 p-6" ng-repeat="CD in BUDGET_CODE_ARRY | unique:'CODE' ">
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='CODE0003'"><i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}} {{CD.POSITION}} - Invalid Hyperlink: Malformed URI is embedded as a hyperlink in the document.please remove hyperlink.</span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='BLANK'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}}-Please provide the mandatory details.
                            <span ng-repeat="BLN in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{BLN.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='CHECK0003'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}} - Please provide True or False.
                            <span ng-repeat="BOL in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{BOL.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='EMAIL0009'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}} - Invalid Email.
                            <span ng-repeat="EM in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{EM.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0010'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}}  - Number Only.
                            <span ng-repeat="NUMO in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NUMO.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0011'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}} - Number/Digit Only.
                            <span ng-repeat="NUM in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NUM.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='NUM0012'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}} - Negative value should not allow.
                            <span ng-repeat="NTC in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{NTC.POSITION}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='DDL0004'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}}  {{CD.POSITION}} - Invalid spelling or either wrong input.
                            <span ng-show="CD.Suggestion.slice(2).length>0">Please select one of the suggested values </span>
                            <span ng-repeat="a in BUDGET_CODE_ARRY | unique:'D_COLUMN_NAME'"><br /> {{a.Suggestion.slice(2)}} </span>
                        </span>
                        <span class="help-block errormessageline" style="padding-left:0px;" ng-if="CD.CODE=='DATE0007'">
                            <i class="fa fa-exclamation-triangle text-danger"></i> {{CD.CODE}}- Please provide 'MM/DD/YYYY' format,example:'02/21/1999'.
                            <span ng-repeat="DAT in BUDGET_CODE_ARRY | filter:{CODE:CD.CODE} "><br />{{$index+1}}:- {{DAT.POSITION}} </span>
                        </span>
                    </div>
                    <span class="help-block errormessageline" style="padding-left:0px;" ng-if="DUPLICATES.length>0">
                        <i class="fa fa-exclamation-triangle text-danger"></i> -Duplicate record found to excel.
                    </span>
                </div>
                <div class="table-responsive custom-scrollbar height-400" ng-show="BRANCH_BUDGETS.length>0">
                    <table class="table table-striped table-head-fixed">
                        <thead class="bg-wenodo-dark-blue">
                            <tr>
                                <th>S.No</th>
                                <th>BUDGET DATE</th>
                                <th>BUDGET CATEGORY</th>
                                <th>BUDGET</th>
                                <th>COVERS</th>
                                <th>FORECASTED SALES</th>
                                <th>FORECASTED COVERS</th>
                            </tr>
                        </thead>
                        <tbody ng-repeat="DSL in BRANCH_BUDGETS" on-finish-render="ngRepeatFinished" ng-init="NGINIT_BRANCH_BUDGETS(DSL)">
                            <tr>
                                <td width="2%">{{$index+1}}</td>
                                <td class="text-nowrap" ng-class="{'error':DSL.BUDGET_DATE.split(':;:').length>1}">
                                    <span ng-show="DSL.BUDGET_DATE.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.BUDGET_DATE.split(':;:')[0]!='BLANK'"> {{DSL.BUDGET_DATE | date }} </span>
                                </td>
                                <td class="text-nowrap" ng-class="{'error':DSL.BUDGET_CATEGORY.split(':;:').length>1}">
                                    <span ng-show="DSL.BUDGET_CATEGORY.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.BUDGET_CATEGORY.split(':;:')[0]!='BLANK'"> {{(DSL.BUDGET_CATEGORY)}} </span>
                                </td>
                                <td class="text-nowrap" ng-class="{'error':DSL.BUDGET.split(':;:').length>1}">
                                    <span ng-show="DSL.BUDGET.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.BUDGET.split(':;:')[0]!='BLANK'"> {{(DSL.BUDGET  | number:2)}} </span>
                                </td>
                                <td class="text-nowrap" ng-class="{'error':DSL.COVERS.split(':;:').length>1}">
                                    <span ng-show="DSL.COVERS.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.COVERS.split(':;:')[0]!='BLANK'"> {{(DSL.COVERS | number:0)}} </span>
                                </td>
                                <td class="text-nowrap" ng-class="{'error':DSL.FORECASTED_SALES.split(':;:').length>1}">
                                    <span ng-show="DSL.FORECASTED_SALES.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.FORECASTED_SALES.split(':;:')[0]!='BLANK'"> {{(DSL.FORECASTED_SALES | number:2)}} </span>
                                </td>
                                <td class="text-nowrap" ng-class="{'error':DSL.FORECASTED_COVERS.split(':;:').length>1}">
                                    <span ng-show="DSL.FORECASTED_COVERS.split(':;:')[0]=='BLANK'"><i class="fa fa-exclamation-triangle"></i></span><span ng-show="DSL.FORECASTED_COVERS.split(':;:')[0]!='BLANK'"> {{(DSL.FORECASTED_COVERS | number:0)}} </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="View_Budget_Log_Detail" aria-modal="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    Your Uploaded File({{UPLOAD_FILE_NAME}})
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="table-responsive custom-scrollbar height-400" ng-show="BRANCH_BUDGET_LOG_DETAILS.length>0">
                    <table class="table table-striped table-head-fixed" id="LOADER_ID">
                        <thead class="bg-wenodo-dark-blue">
                            <tr>
                                <th>BUDGET DATE</th>
                                <th>BUDGET CATEGORY</th>
                                <th>BUDGET</th>
                                <th>COVERS</th>
                                <th>FORECASTED SALES</th>
                                <th>FORECASTED COVERS</th>
                            </tr>
                        </thead>

                        <tbody ng-repeat="CL in BRANCH_BUDGET_LOG_DETAILS" on-finish-render="ngRepeatFinished">
                            <tr>
                                <td>{{CL.BUDGET_DATE | date}}</td>
                                <td>{{CL.BUDGET_CATEGORY}}</td>
                                <td>{{CL.BUDGET | number:2}}</td>
                                <td>{{CL.COVERS | number:0}}</td>
                                <td>{{CL.FORCASTED_SALES | number:2}}</td>
                                <td>{{CL.FORCASTED_COVERS | number:0}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer justify-content-center" ng-show="LOG_GetData">
                <a class="btn btn-secondary text-white" ng-click="LAZY_GET_BRANCH_BUDGET_LOG_DETAILS()">{{VIEWMORERECORD}}</a>
            </div>
        </div>
    </div>
</div>
