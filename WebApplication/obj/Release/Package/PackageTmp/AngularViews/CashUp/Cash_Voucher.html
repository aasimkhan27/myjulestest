<div class="card-header">
    <h5 class="card-title">Voucher</h5>
    <div class="card-tools">
        <ul class="nav nav-pills">
            <li class="nav-item mr-1"><a class="btn btn-wenodo text-white" data-toggle="modal" data-target="#Add_Vouchers">Add</a></li>
            <li class="nav-item"><a class="btn btn-wenodo text-white" data-toggle="modal" ng-click="REDIRECTION_PAGE('VoucherUpload');">Upload</a></li>
        </ul>
    </div>
</div>
<div class="card-body">
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label class="d-block">Branch</label>
                <select name="BRANCH" class="custom-select"
                        ng-options="BRL.BRANCH_ID as BRL.BRANCH_NAME for BRL in BRANCH_LIST"
                        ng-model="VoucherSearch.FILTER_BRANCH_ID" style=""></select>
            </div>
        </div>

        <!--<div class="col">
        <div class="form-group">
            <label class="d-block">Date</label>
            <input type="text"
                   class="form-control dateinputOpenDate"
                   name="datecontrol"
                   autocomplete="off"
                   ng-model="VoucherSearch.FILTER_DATE"
                   ng-value="VoucherSearch.FILTER_DATE | date" />
        </div>
    </div>-->

        <div class="col">
            <div class="form-group">
                <label class="d-block">Invoice #</label>
                <input type="text"
                       class="form-control" placeholder="Enter Invoice number"
                       ng-model="VoucherSearch.FILTER_INVOICE_NUMBER" />
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label class="d-block">Voucher Type</label>
                <select class="custom-select" ng-model=" VoucherSearch.FILTER_VOUCHER_TYPE">
                    <option value="">Select</option>
                    <option value="Pre-Defined">Pre-defined</option>
                    <option value="Open Voucher">Open Voucher</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label class="d-block">Voucher #</label>
                <input type="text"
                       class="form-control" placeholder="Enter Voucher Reference Code"
                       ng-model="VoucherSearch.FILTER_VOUCHER_REFERENCE" />
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label class="d-block">Payment Method</label>
                <select class="custom-select" placeholder="Enter Payment Method"
                        ng-options="Payment.PAYMENT_METHOD_ID as Payment.METHOD_NAME for Payment in PAYMENT_METHODS"
                        ng-model="VoucherSearch.FILTER_PAYMENT_MODE_ID">
                    <option value="">Select</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label class="d-block">Sold To</label>
                <input type="text"
                       class="form-control" placeholder="Enter Sold To"
                       ng-model="VoucherSearch.FILTER_CUSTOMER_NAME" />
            </div>
        </div>



        <div class="col-auto">
            <div class="form-group">
                <label class="d-block">&nbsp;</label>
                <button type="button" ng-click="GET_OPEN_VOUCHER_DETAILS(1)" class="btn btn-wenodo">Search</button>
                <button type="button" ng-click="RESET_GET_VOUCHER()" class="btn btn-w-default">Reset</button>
            </div>
        </div>
    </div>
    <div class="text-center" ng-show="VOUCHER_LIST.length==0" empty-grid>
    </div>
    <div class="table-responsive custom-scrollbar height-67vh" ng-show="VOUCHER_LIST.length>0">
        <table class="table table-hover table-striped table-head-fixed">
            <thead>
                <tr>
                    <th style="width:10%;">Invoice #</th>
                    <th style="width:15%;">Voucher Type</th>
                    <th style="width:8%;">Voucher #</th>
                    <th class="text-right" style="width:12%;" >Voucher Amount</th>
                    <th style="width:10%;">Voucher Date</th>
                    <th style="width:12%;">Payment Method</th>
                    <th style="width:10%;">Sold To</th>
                    <th style="width:10%;">Note</th>
                    <th style="width:10%;">Redeem</th>
                    <th width="3%" class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="DL in VOUCHER_LIST">

                    <td style="width:10%;">{{DL.CHECK_NO}}</td>
                    <td style="width:15%;">{{DL.VOUCHER_TYPE.toUpperCase()}}</td>
                    <td style="width:8%;">{{DL.CODE}}</td>
                    <td class="text-right" style="width:12%;"><span ng-bind-html="CURRENCY_SYMBOL"></span> {{DL.VALUE | number: 2}} </td>

                    <td style="width:10%;"><i ng-show="DL.VALIDITY_DATE !=null" class="far fa-calendar-alt"></i> {{DL.VALIDITY_DATE | date}}</td>
                    <td style="width:12%;"> {{DL.MODE}}</td>
                    <td style="width:10%;"> {{DL.CUSTOMER_NAME}}</td>
                    <td style="width:10%;"> {{DL.NOTE}}</td>
                    <!--<td>{{DL.IS_REDEMMED==1?'Yes':'No' }}</td>-->
                    <td style="width:10%;">{{(DL.IS_REDEMMED==1 || (DL.REMAINING_VALUE < DL.VALUE))?'Yes':'No' }}</td>
                    <td class="text-center">
                        <button ng-show="!DL.IS_CANCELLED && DL.VALUE_REDEMED==0" type="button" class="btn btn-sm btn-danger"
                                ng-click="CANCEL_ENTRY_VOUCHER_DECLARATION(DL)">
                            Cancel
                        </button>
                        <span ng-show="DL.IS_CANCELLED==true" style="color: #fff; background-color: #dbdbdb; box-shadow: none; display: inline-block; border: 2px solid #e6e6e6 !important; font-size: 12px; padding: 7px 11px; -webkit-border-radius: 3px; border-radius: 3px; color: #000; text-align: center; -webkit-transition: all .3s; -o-transition: all .3s; transition: all .3s; font-weight: 600;">Cancelled</span>
                        <span ng-show="(DL.IS_REDEMMED==1 || (DL.REMAINING_VALUE < DL.VALUE))?true:false" style="color: #fff; background-color: #dbdbdb; box-shadow: none; display: inline-block; border: 2px solid #e6e6e6 !important; font-size: 12px; padding: 7px 8px; -webkit-border-radius: 3px; border-radius: 3px; color: #11a345; text-align: center; -webkit-transition: all .3s; -o-transition: all .3s; transition: all .3s; font-weight: 600;">Redeemed</span>

                       
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="8" class="text-center table-footer-fixed" ng-show="GetData">
                        <a class="btn btn-secondary text-white" click-once ng-click="LAZY_GET_VOUCHER_LIST();">{{VIEWMORERECORD}}</a>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="modal fade" id="CancelVoucherForm" aria-modal="true">
    <form id="CancelVoucherForm" name="CancelVoucherForm" novalidate>
        <div class="modal-dialog" id="CancelVoucherForm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Cancellation ({{SELECTED_LINE.CODE}})</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"  ng-click="CANCEL_RESET();">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Cancellation Amount <span class="text-danger">*</span> <small>(Deposit Amount  <span ng-bind-html="CURRENCY_SYMBOL"></span> <span class="bold">{{SELECTED_LINE.VALUE | number:2}}</span> )</small> </label>

                                <input type="text"
                                       class="form-control"
                                       ng-model="SELECTED_LINE.CANCEL_AMT"
                                       name="CANCEL_AMT" placeholder="Enter Cancellation Amount"
                                       required only-digits
                                       ng-class="{'error':CancelVoucherForm.submitted && CancelVoucherForm.CANCEL_AMT.$error.required}" />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Cancellation Comments <span class="text-danger">*</span></label>
                                <textarea class="form-control"
                                          rows="3"
                                          name="CANCEL_COMMENTS"
                                          ng-model="SELECTED_LINE.CANCEL_NOTES"
                                          required placeholder="Enter Cancellation Comments" style="font-size: 13px;"
                                          ng-class="{'error':CancelVoucherForm.submitted && CancelVoucherForm.CANCEL_COMMENTS.$error.required}">
                                                </textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div data-ng-show="CancelVoucherForm.submitted && CancelVoucherForm.$invalid" class="form-group has-error errormessage badge badge-light-red w-100 p-3">
                            <span class="help-block errormessageline"><i class="fa fa-exclamation-triangle"></i> - Please provide the mandatory details to submit(marked in red).</span>
                        </div>
                        <div id="divInvlidUser" class="hideshowdiv" data-ng-show="CancelVoucherForm.$valid">
                            <span class="help-block">{{InvalidUser}}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" ng-click="CANCEL_ENTRY_VOUCHER_DECLARATION()" class="btn btn-wenodo">Save</button>
                    <button type="button" class="btn btn-w-default" data-dismiss="modal" ng-click="CANCEL_RESET();">Close</button>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="modal fade" id="Add_Vouchers" aria-modal="true">
    <form id="AddVoucherForm" name="AddVoucherForm" novalidate>
        <div class="modal-dialog modal-xl">
            <div class="modal-content ">
                <div class="modal-header">
                    <h4 class="modal-title">Add Vouchers</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="RESET_ADDCANCEL()">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Branch</label>
                                <select name="BRANCH" class="custom-select"
                                        ng-options="BRL.BRANCH_ID as BRL.BRANCH_NAME for BRL in BRANCH_LIST"
                                        ng-model="VoucherSearch.BRANCH_ID"></select>
                            </div>
                        </div>
                    </div>

                    <div class="border-bottom"></div>

                    <div class="row my-3">
                        <div class="col-md-1">
                            <div class="form-group">
                                <label for="check" class="text-nowrap">Invoice # <span class="text-danger">*</span></label>
                                <input type="text"
                                       class="form-control"
                                       name="INVOICE_NO" placeholder="Enter Invoice number"
                                       ng-model="VoucherSearch.CHECK_NO"
                                       required
                                       ng-class="{'error':AddVoucherForm.submitted && AddVoucherForm.INVOICE_NO.$error.required}" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="check" class="text-nowrap">Voucher Type </label>
                                <select class="custom-select" ng-model="VoucherSearch.VOUCHER_TYPE" ng-change="SetVoucherValues_basisType(VoucherSearch.VOUCHER_TYPE);">
                                    <option value="Pre-Defined">Pre-defined</option>
                                    <option value="Open Voucher">Open Voucher</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="deposit" class="text-nowrap">Voucher # <span class="text-danger">*</span></label>
                                <select class="custom-select text-xs" ng-show="vouchernumbervisible==true" name="ENTRY_TYPE_DETAIL_ID" 
                                        ng-options="CL.ID as CL.CODE for CL in MasterEntryList | filter:{ENTRY_TYPE_ID:1}" 
                                        ng-model="VoucherSearch.ENTRY_TYPE_DETAIL_ID" ng-change="SetVoucherValues(VISS)">
                                    <option value="">- Please Select-</option>
                                </select>
                                <input class="form-control" name="CODE" placeholder="Enter Voucher #" type="text"  ng-model="VoucherSearch.CODE" required ng-blur="UPLOAD_VOUCHER_CHECK();" ng-class="{'error':AddVoucherForm.submitted && AddVoucherForm.CODE.$error.required}" ng-show="!vouchernumbervisible">

                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="form-group">
                                <label for="value" class="text-nowrap">Amount  <span class="text-danger">*</span></label>
                                <input type="text"
                                       class="form-control"
                                       name="VALUE"
                                       ng-model="VoucherSearch.VALUE" placeholder="Enter Amount"
                                       oninput="this.value = this.value.replace(/[^0-9.-]/g, '').replace(/^(-)|-+/g,'$1').replace(/^([^.]*\.)|\.+/g, '$1');"
                                       ng-blur="CheckDecimal(VISS)"
                                       required
                                       ng-class="{'error':AddVoucherForm.submitted && AddVoucherForm.VALUE.$error.required}" />
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="form-group">
                                <label for="date" class="text-nowrap">Date</label>
                                <input type="text"
                                       class="form-control dateinputOpenDate"
                                       name="datecontrol"
                                       autocomplete="off" placeholder="Enter Date"
                                       ng-model="VoucherSearch.VALIDITY_DATE"
                                       ng-value="VoucherSearch.VALIDITY_DATE | date" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="text-nowrap">Payment Method  <span class="text-danger">*</span></label>
                                <select class="custom-select"
                                        ng-options="Payment.PAYMENT_METHOD_ID as Payment.METHOD_NAME for Payment in PAYMENT_METHODS"
                                        ng-model="VoucherSearch.PAYMENT_METHOD_ID"
                                        name="PAYMENT_METHOD_ID" ng-change="SetPayment(VoucherSearch.PAYMENT_METHOD_ID)"
                                        required
                                        ng-class="{'error':AddVoucherForm.submitted && AddVoucherForm.PAYMENT_METHOD_ID.$error.required}">
                                    <option value="">Select</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="form-group">
                                <label for="nameofpayee" class="text-nowrap">Sold To</label>
                                <input type="text"
                                       class="form-control"
                                       name="CUSTOMER_NAME" placeholder="Enter Sold To"
                                       ng-model="VoucherSearch.CUSTOMER_NAME" />
                            </div>
                        </div>


                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="note" class="text-nowrap">Note</label>
                                <div class="d-flex">
                                    <input type="text"
                                           name="NOTE"
                                           class="form-control" placeholder="Enter Note"
                                           ng-model="VoucherSearch.NOTE" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div data-ng-show="AddVoucherForm.submitted && AddVoucherForm.$invalid" class="form-group has-error errormessage badge badge-light-red w-100 p-3">
                            <span class="help-block errormessageline"><i class="fa fa-exclamation-triangle"></i> - Please provide the mandatory details to submit(marked in red).</span>
                        </div>
                        <div id="divInvlidUser" class="hideshowdiv" data-ng-show="AddVoucherForm.$valid">
                            <span class="help-block">{{InvalidUser}}</span>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <div class="form-group text-nowrap">
                        <button type="button"
                                ng-click="INSERT_ENTRY_VOUCHER_DECLARATION()"
                                class="btn btn-wenodo">
                            Save & close
                        </button>
                        <button type="button"
                                ng-click="INSERT_ENTRY_VOUCHER_DECLARATION(1)"
                                class="btn btn-w-default">
                            Save & Continue
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>