<ul class="nav nav-tabs" id="custom-content-below-tab" role="tablist">
    <li class="nav-item" ng-click="TAB_CLICK_APPROVE_FY(1)">
        <a class="nav-link " ng-class="{'active':TAB_FLAG==1}" data-toggle="pill" role="tab" aria-controls="custom-content-below-home" aria-selected="true">Action Required</a>
    </li>
    <li class="nav-item" ng-click="TAB_CLICK_APPROVE_FY(2)">
        <a class="nav-link " ng-class="{'active':TAB_FLAG==2}" data-toggle="pill" role="tab" aria-controls="custom-content-below-home" aria-selected="true">Processed</a>
    </li>
    <li class="nav-item" ng-click="TAB_CLICK_APPROVE_FY(3)" ng-show="CheckSubModuleAccess(134) || CheckSubModuleAccess(156)">
        <a class="nav-link " ng-class="{'active':TAB_FLAG==3}" data-toggle="pill" role="tab" aria-controls="custom-content-below-home" aria-selected="true">All</a>
    </li>
</ul>
<div class="tab-content" id="custom-content-below-tabContent">
    <div class="tab-pane fade " ng-class="{'show active':TAB_FLAG==1}" id="custom-content-below-home" role="tabpanel" aria-labelledby="custom-content-below-home-tab">
        <div class="row">
            <div class="col-md-3 custom-scrollbar height-77vh stick-top">
                <div class="col-md-12 px-0 pb-1 sticky-top bg-white">
                    <form id="SearchForm" name="SearchForm" novalidate autocomplete="off">
                        <div class="search-form-group">
                            <input type="text" ng-model="ApprovalViewSearch.SEARCH_NAME" class="form-control" placeholder="Search by Item / Description / Request #" />
                            <button type="submit" class="btn btn-wenodo" 
                                     click-once
                                    ng-click="GET_APPROVAL_HEADERS_FOR_APPROVER(1,4,false)"></button>
                        </div>
                    </form>
                </div>
                <div class="detailed-card " ng-class="{'active':APL.PR_NUMBER==ApprovalViewSearch.REQUEST_DETAILS.PR_NUMBER}"
                     ng-repeat="APL in HEADERS_FOR_APPROVER_LIST"
                     ng-click="PURCHASE_REQUEST_APPROVAL_CLICK(APL)">
                    <div class="card-body">
                        <div class="row align-items-center height-100p">
                            <div class="col">
                                <span class="po-details text-limit-2 font-12">{{APL.PR_NUMBER}} | {{APL.ITEM_NAME}}</span>
                                <span class="po-supplier font-10 mt-2">
                                    {{APL.REQUESTOR_NAME}}
                                    <span class="po-supplier float-right  font-10">{{APL.BRANCH_NAME}}</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12" ng-show="GetActionData">
                    <button type="button" ng-click="GET_APPROVAL_HEADERS_FOR_APPROVER_LAZY_LOAD()" class="btn btn-block btn-w-default">
                        {{VIEWMORERECORD}}
                    </button>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row align-content-center mn-height-66vh" ng-show="HEADERS_FOR_APPROVER_LIST.length==0">
                    <div class="col-md-12 text-center">
                        <h5 class="text-muted">
                            <span class="d-block mb-3">
                                <img src="../../../E_Content/images/sorted.png" />
                            </span>
                            Everything's sorted!
                        </h5>
                    </div>
                </div>
                <div class="card-body" ng-show="HEADERS_FOR_APPROVER_LIST.length>0">
                    <div class="row">
                        <div class="col">
                            <h5 class="po-details font-14 ">
                                {{ApprovalViewSearch.REQUEST_DETAILS.PR_NUMBER}} | {{ApprovalViewSearch.REQUEST_DETAILS.ITEM_NAME}}
                            </h5>
                        </div>
                        <div class="col-auto">
                            <button type="button" 
                                    ng-click="PR_VALIDATION_CLICK_FY(37)" 
                                    ng-show="ApprovalData.ACTION_REQUIRED==1 " 
                                    class="btn btn-wenodo">Approve</button>
                            <button type="button" 
                                    ng-click="PR_VALIDATION_FORCE_CLICK_FY(37,SELECTED_REQ)" 
                                    ng-show="CheckSubModuleAccess(141)" 
                                    class="btn btn-wenodo">Force Approve</button>
                            <button type="button" 
                                    ng-click="PR_VALIDATION_CLICK_FY(38)" 
                                    ng-show="ApprovalData.ACTION_REQUIRED==1" 
                                    class="btn btn-danger">Reject</button>
                            <button type="button" 
                                    ng-click="PR_VALIDATION_FORCE_CLICK_FY(38,SELECTED_REQ)" 
                                    ng-show="CheckSubModuleAccess(141)" 
                                    class="btn btn-danger">Force Reject</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <span class="po-supplier"><span class="text-normal">By </span>{{ApprovalViewSearch.REQUEST_DETAILS.REQUESTOR_NAME}} <span class="text-normal">on</span> {{ApprovalViewSearch.REQUEST_DETAILS.PR_CREATED_DATE | date}}</span>
                            <span class="po-supplier">
                                <span class="text-normal">Raised For</span> {{ApprovalViewSearch.REQUEST_DETAILS.BRANCH_NAME}}
                                <span class="badge badge-danger float-right">{{ApprovalViewSearch.REQUEST_DETAILS.URGENT_REQUEST?'Urgent':''}}</span>
                            </span>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 pr-4">

                            <label class="text-bold mt-2">Description: </label>
                            <span class="d-block font-12">
                                {{ ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION==null || ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION==''?'-': ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION | limitTo:LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO">...</span>
                                <span class="btn btn-xs btn-wenodo d-inline-flex"
                                      ng-show="ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO || ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO"
                                      ng-click="READ_MORE(ApprovalViewSearch.REQUEST_DETAILS,(ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?1:2))"
                                      data-toggle="tooltip"
                                      data-html="true"
                                      data-original-title="{{ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?'Read More':'Hide'}}">
                                    <i ng-class="{'fa-minus':ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO,'fa-plus':ApprovalViewSearch.REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO}" class="far "></i>
                                </span>
                            </span>
                            <label class="text-bold">Comments:</label>
                            <span class="d-block font-12">
                                {{ApprovalViewSearch.REQUEST_DETAILS.COMMENTS==null || ApprovalViewSearch.REQUEST_DETAILS.COMMENTS==''?'-': ApprovalViewSearch.REQUEST_DETAILS.COMMENTS | limitTo:COMMENTS_LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO">...</span>
                                <!--<span class="btn btn-xs btn-wenodo d-inline-flex" ng-show="" ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.REQUEST_DETAILS,1)" data-toggle="tooltip" data-html="true" data-original-title="Read More"><i class="far fa-plus"></i></span>-->
                                <span class="btn btn-xs btn-wenodo d-inline-flex"
                                      ng-show="ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length==COMMENTS_LIMIT_TO || ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO"
                                      ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.REQUEST_DETAILS,(ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length>LIMIT_TO?1:2))"
                                      data-toggle="tooltip"
                                      data-html="true"
                                      data-original-title="{{ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO?'Read More':'Hide'}}">
                                    <i ng-class="{'fa-minus':ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length==COMMENTS_LIMIT_TO,'fa-plus':ApprovalViewSearch.REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO}" class="far "></i>
                                </span>
                            </span>
                        </div>
                        <div class="col-md-4">
                            <label class="text-bold">Quantity:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.REQUEST_DETAILS.QUANTITY | number:2}} {{ApprovalViewSearch.REQUEST_DETAILS.UOM_NAME}}</span>
                            <label class="mt-2 text-bold">Expected Amount:</label>
                            <span class="po-supplier"> {{ApprovalViewSearch.REQUEST_DETAILS.EXPECTED_PRICE | number :2}} <span class="text-bold">{{ApprovalViewSearch.REQUEST_DETAILS.CURRENCY_CODE}}</span></span>

                            <label class="mt-2 text-bold">Required Date:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.REQUEST_DETAILS.REQUIRED_DATE==null || ApprovalViewSearch.REQUEST_DETAILS.REQUIRED_DATE=="" ?'-':ApprovalViewSearch.REQUEST_DETAILS.REQUIRED_DATE | date}}</span>

                            <label class="mt-2 text-bold">Suggested Supplier:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.REQUEST_DETAILS.SUGGESTED_SUPPLIER==null || ApprovalViewSearch.REQUEST_DETAILS.SUGGESTED_SUPPLIER=="" ?'-':ApprovalViewSearch.REQUEST_DETAILS.SUGGESTED_SUPPLIER  }}</span>


                            <label class="mt-2 text-bold">Attachments:</label>
                            <div ng-show="ApprovalViewSearch.REQUEST_DETAILS.UploadedFiles == null || ApprovalViewSearch.REQUEST_DETAILS.UploadedFiles.length==0">No attachment</div>
                            <div class="file-block" ng-repeat="FILE in ApprovalViewSearch.REQUEST_DETAILS.UploadedFiles">
                                <div class="file-info">
                                    <i class="far fa-file-alt file-icon"></i>
                                    <span class="text-limit-1"> <a href="../P2PFiles/{{FILE.FILE_PATH}}{{FILE.SERVER_FILE_NAME}}" download="{{FILE.ORIGINAL_FILE_NAME}}">  {{FILE.ORIGINAL_FILE_NAME}} </a></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form name="RequestUpdForm" novalidate>
                        <div class="row my-4 ">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="d-block">Expected Amount <span class="text-danger">*</span></label>
                                    <input type="text"
                                           required
                                           class="form-control"
                                           only-digits
                                           maxlength="13"
                                           placeholder="Enter expected amount"
                                           name="APPROVER_EXPECTED_PRICE"
                                           ng-model="PurchaseRequestSearch.APPROVER_EXPECTED_PRICE"
                                           ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.APPROVER_EXPECTED_PRICE.$error.required || PurchaseRequestSearch.APPROVER_EXPECTED_PRICE==0 && RequestUpdForm.submitted}" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="d-block">Project Name</label>
                                    <div class="form-group">
                                        <select class="custom-select mw-150"
                                                name="PROJECT_MASTER_ID"
                                                ng-model="PurchaseRequestSearch.PROJECT_MASTER_ID"
                                                ng-change="CHANGE_PROJECT_fn()"
                                                ng-options="T.PROJECT_MASTER_ID as T.PROJECT_NAME for T in PROJECT_MASTER_LIST"
                                                ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.PROJECT_MASTER_ID.$error.required}">
                                            <option value="">-Select Project-</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="d-block">GL Account <span class="text-danger">*</span></label>
                                    <div class="AddCustomScroll_Account">
                                        <input type="text" name="XERO_ACCOUNT_CODE{{$index}}"
                                               ng-model="PurchaseRequestSearch.ACCOUNT_DETAILS"
                                               typeahead-on-select="CHANGE_BUDGET_fn($item, 1, $label)"
                                               ng-change="SetAccountPRValues(PRL,$index);"
                                               uib-typeahead="Acct.CODE + ' - ' + Acct.NAME  for Acct in XERO_ACCOUNT_CODES | filter:$viewValue"
                                               typeahead-loading="loading" typeahead-no-results="noResults"
                                               class="form-control"
                                               autocomplete="off"
                                               required
                                               placeholder="Type to select GL Account..."
                                               ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.XERO_ACCOUNT_CODE{{$index}}.$error.required || CREATE_REQ_FORM.submitted && CREATE_REQ_FORM.IS_ACCOUNT_VALID}" />
                                    </div>
                                    <small ng-show="PurchaseRequestSearch.IS_ACCOUNT_VALID" class="text-red text-bold">Invalid GL Account</small>
                                </div>
                            </div>


                        </div>
                    </form>
                    <div class="col-md-12">
                        <div class="card-header w-100">
                            <h5 class="card-title mt-1">
                                Budget <span ng-show="P2P_BUDGET_MASTER_LIST.length>0">
                                    ({{ApprovalViewSearch.BUDGET_NAME}})
                                </span>
                            </h5>
                            <button type="button"
                                    data-toggle="tooltip"
                                    data-html="true"
                                    ng-click="CHANGE_BUDGET_fn(ApprovalViewSearch,1)"
                                    class="btn btn-transparent-wenodo ml-2 border  float-right">
                                Refresh Budget
                            </button>
                        </div>
                        <div class="col-md-12 mt-2" ng-show="P2P_BUDGET_MASTER_LIST.length>0">
                            <span class="po-amount">The following budgets would be affected by the approval of the request.</span>
                        </div>
                        <div class="col-md-12 text-center mt-2"
                             ng-show="P2P_BUDGET_MASTER_LIST.length==0">
                            <div class="alert bg-custom-blue">{{BUDGET_TEXT_VALIDATION}}</div>
                        </div>
                        <div class="card-body p-0 mt-2" ng-show="P2P_BUDGET_MASTER_LIST.length>0">
                            <div class="table-responsive custom-scrollbar">
                                <table class="table table-head-fixed table-hover">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>GL Account </th>
                                            <th>Period</th>
                                            <th class="text-right">Total</th>
                                            <th class="text-right">Remaining</th>
                                            <th class="text-right">Consumed</th>
                                            <th class="text-right">Booked</th>
                                            <th class="text-right">Credit Notes</th>
                                            <th class="text-right">Current</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="BD in P2P_BUDGET_MASTER_LIST">
                                        <tr>
                                            <td rowspan="3">{{BD.GLACCOUNT_NAME}}</td>
                                            <td colspan="7" ng-if="BD.DB_ACCOUNT_ID==0" class="text-align-center text-bold">There is no budget allocated in this GL Account</td>
                                        </tr>
                                        <tr ng-if="BD.DB_ACCOUNT_ID!=0" ng-repeat="BL in BD.BUDGET_DETAILS_LIST"
                                            ng-init="BL.CURRENT_PO_CUSTOM=0;"
                                            ng-click="VIEW_BUDGET_fn(BD,ApprovalViewSearch.REQUEST_DETAILS.PR_CREATED_DATE,PurchaseRequestSearch.PROJECT_MASTER_ID,ApprovalViewSearch,PurchaseRequestSearch,'PR_ACTION')">
                                            <td>{{BL.PERIOD}}</td>
                                            <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                            <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                                {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT_PO_CUSTOM*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2}}
                                                <span ng-show="false">
                                                    {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0?true:BL.REMAINING_AMOUNT>0?false:BD.IS_OVER_BUDGET?true:false)}}
                                                </span>

                                            </td>
                                            <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                            <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                            <td class="text-right">
                                                <span ng-show="BL.MEMO==0">{{BL.MEMO*-1 | number :2}}</span><span ng-show="BL.MEMO!=0">({{BL.MEMO*-1 | number :2}})</span>
                                            </td>
                                            <td class="text-right">
                                                <span ng-show="false">{{(BL.CURRENT_PO_CUSTOM=PurchaseRequestSearch.APPROVER_EXPECTED_PRICE>0?PurchaseRequestSearch.APPROVER_EXPECTED_PRICE:0) }}</span>
                                                {{BL.CURRENT_PO_CUSTOM | number:2}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="alert alert-warning-red" ng-show="(P2P_BUDGET_MASTER_LIST | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This request is going over budget.
                        </div>
                    </div>


                    <div class="card-header "><h5 class="card-title">Approval Workflow</h5></div>
                    <div class="row align-items-center mt-3">
                        <div class="col d-flex custom-scrollbar horizontal_scroll" style="min-height:350px;">
                            <div class="col-md-2" ng-repeat-start="APL in APPROVAL_HEADERS_CHAIN_LIST  | unique:'APPROVAL_CHAIN_GROUP_ID'"
                                 ng-init="InitiateApprover(APL)">
                                <div class="row pl-2">
                                    <span ng-show="false">{{APL.APL_INDEX=$index+1}}</span>
                                    <div class="col-md-12 pl-1">
                                        <button type="button" class="btn btn-w-default w-100 text-nowrap"
                                                ng-class="{'active':APL.STEP_ACTIVE==1, 'active-approved':APL.SEQUENCE_APPROVED}">
                                            {{APL.GROUP_NAME}}
                                        </button>
                                    </div>
                                    <span class="w-100 z-index-997">
                                        Approval condition: {{APL.ANY_ALL_FLAG==0?'All':'Any'}} <span ng-show="APL.ANY_ALL_FLAG>0"> of {{APL.ANY_ALL_FLAG}}</span>
                                    </span>
                                    <div class="col-auto pl-1 mt-2"
                                         ng-repeat="User in APPROVAL_HEADERS_CHAIN_LIST | filter:{APPROVAL_CHAIN_GROUP_ID:APL.APPROVAL_CHAIN_GROUP_ID}"
                                         ng-init="InitiateNameApprover(User,APL)">
                                        <div class="sec-center mt-1">
                                            <span ng-show="false"> {{ User.ACTION_REQUIRED==1?APL.STEP_ACTIVE=true :''}}</span>
                                            <input class="dropdown" type="checkbox" id="dropdown{{$index}}{{APL.APL_INDEX}}" name="dropdown" />
                                            <label class="name-badge-short cursor-pointer"
                                                   ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-pending': User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}"
                                                   for="dropdown{{$index}}{{APL.APL_INDEX}}">{{User.SHORT_NAME}}</label>
                                            <div class="section-dropdown">
                                                <div class="card-header">
                                                    <div class="name-badge d-inline">{{User.SHORT_NAME}}</div>
                                                    <span class="mt-2 ml-2">{{User.APPROVER_NAME}}</span>
                                                    <span class="badge  text-white float-right"
                                                          ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-pending':User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}">{{User.STATUS_NAME}}</span>
                                                </div>
                                                <div class="col-md-12">
                                                    <ul class="products-list product-list-in-card">
                                                        <li class="item  pt-0">
                                                            <div class="product-info ml-0">
                                                                <div class="product-title">
                                                                    {{User.APPROVER_EMAIL}}
                                                                    <span class="d-block" ng-if="User.LAST_ACTION_TAKEN_DATE!=null">{{User.LAST_ACTION_TAKEN_DATE | toDate | date}}, {{User.LAST_ACTION_TAKEN_DATE | toDate | date:'H:M'}}</span>
                                                                </div>
                                                            </div>
                                                        </li>
                                                        <li class="item">
                                                            <div class="product-info ml-0 font-12 custom-scrollbar" style="max-height:100px">
                                                                {{User.COMMENTS==null?'-':User.COMMENTS}}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-auto" ng-if="APL.showborder && !$last" ng-repeat-end><i class="far fa-angle-right text-grey mt-1"></i></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade " ng-class="{'show active':TAB_FLAG==2}" id="custom-content-below-home" role="tabpanel" aria-labelledby="custom-content-below-home-tab">
        <div class="row">
            <div class="col-md-3 custom-scrollbar height-77vh stick-top">
                <div class="col-md-12 px-0 sticky-top bg-white">
                    <form id="ProcSearchForm" name="ProcSearchForm" novalidate autocomplete="off">
                        <div class="search-form-group">
                            <input type="text" ng-model="ApprovalViewSearch.PROCESS_SEARCH_NAME" class="form-control" placeholder="Search by Item / Description / Request #" />
                            <button type="submit" class="btn btn-wenodo" 
                                     click-once
                                    ng-click="GET_APPROVAL_HEADERS_FOR_APPROVER_PROCESS(1,4,false)"></button>
                        </div>
                    </form>
                </div>
                <div class="detailed-card" ng-class="{'active':APL.PR_NUMBER==ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PR_NUMBER}" ng-repeat="APL in PURCHASE_REQUESTS_PROCESS_LIST" ng-click="PURCHASE_REQUEST_PROCESSED_APPROVAL_CLICK(APL)">
                    <div class="card-body">
                        <div class="row align-items-center height-100p">
                            <div class="col">
                                <span class="po-details text-limit-2 font-12">{{APL.PR_NUMBER}} | {{APL.ITEM_NAME}}</span>
                                <span class="po-supplier font-10 mt-2">{{APL.REQUESTOR_NAME}} </span>
                            </div>
                            <div class="col-auto text-right">
                                <span class="badge" ng-class="{'border-badge':APL.APPROVER_STATUS_ID==74,'badge-light-green':APL.APPROVER_STATUS_ID==37,'badge-danger':APL.APPROVER_STATUS_ID==38 || APL.APPROVER_STATUS_ID==42}">{{APL.APPROVER_STATUS_NAME}}</span>
                                <span class="po-supplier font-10 mt-2">{{APL.BRANCH_NAME}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12" ng-show="GetProcessData">
                    <button type="button" ng-click="GET_APPROVAL_HEADERS_FOR_APPROVER_PROCESS_LAZY_LOAD()" class="btn btn-block btn-w-default">
                        {{VIEWMORERECORD}}
                    </button>
                </div>
            </div>

            <div class="col-md-9">
                <div class="row align-content-center mn-height-66vh" ng-show="PURCHASE_REQUESTS_PROCESS_LIST.length==0">
                    <div class="col-md-12 text-center">
                        <h5 class="text-muted">
                            <span class="d-block mb-3">
                                <img src="../../../E_Content/images/sorted.png" />
                            </span>
                            Everything's sorted!
                        </h5>
                    </div>
                </div>
                <div class="card-body" ng-show="PURCHASE_REQUESTS_PROCESS_LIST.length>0">
                    <div class="row">
                        <div class="col">
                            <h5 class="po-details font-14 ">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PR_NUMBER}} | {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.ITEM_NAME}} </h5>
                        </div>
                        <div class="col-auto">
                            <span class="badge text-100" ng-class="{'badge-light-green':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_ID==37,'badge-danger':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_ID==38 || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_ID==42}">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_NAME}}</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <span class="po-supplier"><span class="text-normal">By </span>{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.REQUESTOR_NAME}} <span class="text-normal">on</span> {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PR_CREATED_DATE | date}}</span>
                            <span class="po-supplier"><span class="text-normal">Raised For</span> {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.BRANCH_NAME}} </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 pr-4">


                            <label class="text-bold mt-2">Description: <span class="po-supplier text-danger d-inline">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.URGENT_REQUEST?'Urgent':''}}</span></label>
                            <span class="d-block font-12">
                                {{ ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION==''?'-': ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION | limitTo:LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO">...</span>

                                <span class="btn btn-xs btn-wenodo d-inline-flex"
                                      ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO"
                                      ng-click="READ_MORE(ApprovalViewSearch.PROCESS_REQUEST_DETAILS,(ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?1:2))"
                                      data-toggle="tooltip"
                                      data-html="true"
                                      data-original-title="{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?'Read More':'Hide'}}">
                                    <i ng-class="{'fa-minus':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO,'fa-plus':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO}" class="far "></i>
                                </span>
                            </span>
                            <label class="text-bold">Comments:</label>
                            <span class="d-block font-12">
                                {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS==''?'-': ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS | limitTo:COMMENTS_LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO">...</span>
                                <span class="btn btn-xs btn-wenodo d-inline-flex" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO" ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.PROCESS_REQUEST_DETAILS,1)" data-toggle="tooltip" data-html="true" data-original-title="Read More"><i class="far fa-plus"></i></span>
                                <span class="btn btn-xs btn-wenodo d-inline-flex" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.COMMENTS.length==COMMENTS_LIMIT_TO" ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.PROCESS_REQUEST_DETAILS,2)" data-toggle="tooltip" data-html="true" data-original-title="Hide"><i class="far fa-minus"></i></span>
                            </span>
                        </div>
                        <div class="col-md-4">
                            <label class="text-bold">Quantity:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.QUANTITY | number:2}} {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.UOM_NAME}}</span>
                            <label class="mt-2 text-bold">Expected Amount:</label>
                            <span class="po-supplier" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.EXPECTED_PRICE!=null">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.EXPECTED_PRICE | number :2}}  <span class="text-bold">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.CURRENCY_CODE}}</span></span>
                            <span class="po-supplier" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.EXPECTED_PRICE==null">-</span>

                            <label class="mt-2 text-bold">Required Date:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.REQUIRED_DATE==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.REQUIRED_DATE=="" ?'-': ApprovalViewSearch.PROCESS_REQUEST_DETAILS.REQUIRED_DATE | date}}</span>

                            <label class="mt-2 text-bold">Suggested Supplier:</label>
                            <span class="po-supplier">
                                {{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SUGGESTED_SUPPLIER==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SUGGESTED_SUPPLIER=="" ?'-':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SUGGESTED_SUPPLIER  }}
                            </span>
                            <label class="mt-2 text-bold">Attachments:</label>
                            <div ng-show="ApprovalViewSearch.UploadedFiles.length==0">No attachment</div>
                            <div id="attachmentblock">
                                <div class="file-block" ng-repeat="FILE in ApprovalViewSearch.UploadedFiles track by $index">
                                    <div class="file-info">
                                        <i class="far fa-file-alt file-icon"></i>
                                        <span class="text-limit-1"> <a href="../P2PFiles/{{FILE.FILE_PATH}}{{FILE.SERVER_FILE_NAME}}" download="{{FILE.ORIGINAL_FILE_NAME}}">  {{FILE.ORIGINAL_FILE_NAME}} </a></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row my-4">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Expected Amount <span class="text-danger">*</span></label>
                                <span class="po-supplier">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE=="" ?'-':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE | number :2}}</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Project Name</label>
                                <div class="form-group">
                                    <span class="po-supplier">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PROJECT_NAME==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PROJECT_NAME=="" ?'-':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PROJECT_NAME}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">GL Account <span class="text-danger">*</span></label>
                                <span class="po-supplier">{{ApprovalViewSearch.PROCESS_REQUEST_DETAILS.ACCOUNT_DETAILS==null || ApprovalViewSearch.PROCESS_REQUEST_DETAILS.ACCOUNT_DETAILS=="" ?'-':ApprovalViewSearch.PROCESS_REQUEST_DETAILS.ACCOUNT_DETAILS}}</span>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-12" ng-show="false && ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_ID!=38 &&  ApprovalViewSearch.PROCESS_REQUEST_DETAILS.APPROVER_STATUS_ID!=42 && P2P_PROCESS_BUDGET_MASTER_LIST.length>0">
                        <div class="card-header w-100">
                            <h5 class="card-title mt-1"> Budget <span ng-show="P2P_PROCESS_BUDGET_MASTER_LIST.length>0"> ({{ApprovalViewSearch.BUDGET_NAME}}) </span></h5>
                            <div class="card-tools">
                                <button type="button"
                                        ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.OVERALL_STATUS_ID!=39 && ApprovalViewSearch.PROCESS_REQUEST_DETAILS.OVERALL_STATUS_ID!=38 && ApprovalViewSearch.PROCESS_REQUEST_DETAILS.OVERALL_STATUS_ID!=42"
                                        ng-click="GET_P2P_BUDGET_SNAPSHOT(ApprovalViewSearch.PROCESS_REQUEST_DETAILS);ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SHOW_REQ_BUDGET=!ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SHOW_REQ_BUDGET;"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    View Requisition Budget
                                </button>
                            </div>
                        </div>
                        <div class="col-md-12 mt-2" ng-show="P2P_PROCESS_BUDGET_MASTER_LIST.length>0">
                            <span class="po-amount">The following budgets would be affected by the approval of the request.</span>
                        </div>
                        <div class="col-md-12 text-center mt-2"
                             ng-show="P2P_PROCESS_BUDGET_MASTER_LIST.length==0">
                            <div class="alert bg-custom-blue">{{BUDGET_TEXT_VALIDATION}}</div>
                        </div>
                        <div class="card-body p-0 mt-2" ng-show="P2P_PROCESS_BUDGET_MASTER_LIST.length>0">
                            <div class="table-responsive custom-scrollbar">
                                <table class="table table-head-fixed table-hover">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>GL Account </th>
                                            <th>Period</th>
                                            <th class="text-right">Total</th>
                                            <th class="text-right">Remaining</th>
                                            <th class="text-right">Consumed</th>
                                            <th class="text-right">Booked</th>
                                            <th class="text-right">Credit Notes</th>
                                            <th class="text-right">Current</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="BD in P2P_PROCESS_BUDGET_MASTER_LIST">
                                        <tr>
                                            <td rowspan="3">{{BD.GLACCOUNT_NAME}}</td>
                                            <td colspan="7" ng-if="BD.DB_ACCOUNT_ID==0" class="text-align-center text-bold">There is no budget allocated in this GL Account</td>
                                        </tr>
                                        <tr ng-if="BD.DB_ACCOUNT_ID!=0" ng-repeat="BL in BD.BUDGET_DETAILS_LIST" ng-init="BL.CURRENT_PO_CUSTOM=0;"
                                            ng-click="VIEW_BUDGET_fn(BD,ApprovalViewSearch.PROCESS_REQUEST_DETAILS.PR_CREATED_DATE,PurchaseRequestSearch.PROCESS_REQUEST_DETAILS.PROJECT_MASTER_ID,ApprovalViewSearch,PurchaseRequestSearch,'PR_PROC')">
                                            <td>{{BL.PERIOD}}</td>
                                            <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                            <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                                {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT_PO_CUSTOM*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2}}
                                                <span ng-show="false">
                                                    {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0 && BD.BUDGET_DETAILS_LIST.length==BL.LINE_ID?true:BD.IS_OVER_BUDGET?true:false)}}
                                                </span>
                                            </td>
                                            <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                            <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                            <td class="text-right">
                                                <span ng-show="BL.MEMO==0">{{BL.MEMO*-1 | number :2}}</span><span ng-show="BL.MEMO!=0">({{BL.MEMO*-1 | number :2}})</span>
                                            </td>
                                            <td class="text-right">
                                                <span ng-show="false">{{(BL.CURRENT_PO_CUSTOM=PurchaseRequestSearch.APPROVER_EXPECTED_PRICE>0?PurchaseRequestSearch.APPROVER_EXPECTED_PRICE:0)}}</span>
                                                {{BL.CURRENT_PO_CUSTOM | number:2}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="alert alert-warning-red" ng-show="(P2P_PROCESS_BUDGET_MASTER_LIST | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This Requisition is going over budget.
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card-header w-100">
                            <h5 class="card-title mt-1">
                                Requisition Budget (This shows the budget when the requisition was posted) <span ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length>0"></span>
                            </h5>
                            <div class="card-tools" ng-show="false">
                                <button type="button" class="btn btn-transparent-wenodo border"
                                        ng-click="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SHOW_REQ_BUDGET=!ApprovalViewSearch.PROCESS_REQUEST_DETAILS.SHOW_REQ_BUDGET">
                                    <i class="fa fa-close"
                                       data-toggle="tooltip" data-html="true"
                                       data-original-title="Hide"></i>
                                </button>

                            </div>
                        </div>
                        <div class="col-md-12 text-center mt-2" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length==0" empty-grid> </div>
                        <div class="card-body p-0 mt-2" ng-show="ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length>0">
                            <div class="table-responsive custom-scrollbar">
                                <table class="table table-head-fixed table-hover">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>GL Account </th>
                                            <th>Period</th>
                                            <th class="text-right">Total</th>
                                            <th class="text-right">Remaining</th>
                                            <th class="text-right">Consumed</th>
                                            <th class="text-right">Booked</th>
                                            <th class="text-right">Credit Notes</th>

                                            <th class="text-right" ng-show="false">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="BD in ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | unique:'ACCOUNT_ID'">
                                        <tr>
                                            <td rowspan="3">{{BD.ACCOUNT_DETAILS}}</td>
                                            <td colspan="7" ng-if="BD.DB_ACCOUNT_ID==0" class="text-align-center text-bold">There is no budget allocated in this GL Account</td>
                                        </tr>
                                        <tr ng-if="BD.DB_ACCOUNT_ID!=0"
                                            ng-repeat="BL in ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | filter:{ACCOUNT_ID:BD.ACCOUNT_ID}">
                                            <td>{{BL.PERIOD}}</td>
                                            <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                            <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                                <span ng-show="false">
                                                    {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0 && (ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | unique:'ACCOUNT_ID').length==BL.LINE_ID?true:BD.IS_OVER_BUDGET?true:false)}}
                                                </span>
                                                {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2 }}
                                            </td>
                                            <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                            <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                            <td class="text-right">
                                                <span ng-show="BL.MEMO==0">{{BL.MEMO*-1 | number :2}}</span><span ng-show="BL.MEMO!=0">({{BL.MEMO*-1 | number :2}})</span>
                                            </td>
                                            <td class="text-right" ng-show="false">
                                                {{BL.CURRENT | number:2}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="alert alert-warning-red" ng-show="(ApprovalViewSearch.PROCESS_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This Requisition  is going over budget.
                        </div>
                    </div>
                    <div class="card-header"><h5 class="card-title">Approval Workflow</h5></div>
                    <div class="row align-items-center mt-3">
                        <div class="col d-flex custom-scrollbar horizontal_scroll" style="min-height:350px;">
                            <div class="col-md-2" ng-repeat-start="APL in PROCESSED_APPROVAL_HEADERS_CHAIN_LIST  | unique:'APPROVAL_CHAIN_GROUP_ID'" ng-init="InitiateApprover(APL)">
                                <div class="row pl-2">
                                    <span ng-show="false">{{APL.APL_INDEX=$index+1}}</span>
                                    <div class="col-md-12 pl-1">
                                        <button type="button" class="btn btn-w-default w-100 text-nowrap" ng-class="{'active':APL.STEP_ACTIVE==1, 'active-approved':APL.SEQUENCE_APPROVED}">{{APL.GROUP_NAME}} </button>
                                    </div>
                                    <span class="w-100 z-index-997">
                                        Approval condition: {{APL.ANY_ALL_FLAG==0?'All':'Any'}} <span ng-show="APL.ANY_ALL_FLAG>0"> {{APL.ANY_ALL_FLAG}}</span>
                                    </span>
                                    <div class="col-auto pl-1 mt-2"
                                         ng-repeat="User in PROCESSED_APPROVAL_HEADERS_CHAIN_LIST | filter:{APPROVAL_CHAIN_GROUP_ID:APL.APPROVAL_CHAIN_GROUP_ID}"
                                         ng-init="InitiateNameApprover(User,APL)">
                                        <div class="sec-center mt-1">
                                            <span ng-show="false"> {{ User.ACTION_REQUIRED==1?APL.STEP_ACTIVE=true :''}}</span>
                                            <input class="dropdown" type="checkbox" id="Prodropdown{{$index}}{{APL.APL_INDEX}}" name="dropdown{{$index}}" />
                                            <label class="name-badge-short cursor-pointer"
                                                   ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-action-required':User.ACTION_REQUIRED==1 &&  User.STATUS_ID==39,'name-badge-pending':User.ACTION_REQUIRED!=1 && User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}"
                                                   for="Prodropdown{{$index}}{{APL.APL_INDEX}}">{{User.SHORT_NAME}}</label>
                                            <div class="section-dropdown">
                                                <div class="card-header">
                                                    <div class="name-badge d-inline">{{User.SHORT_NAME}} </div>
                                                    <span class="mt-2 ml-2">{{User.APPROVER_NAME}}</span>
                                                    <span class="badge  text-white float-right"
                                                          ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-pending':User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}">{{User.STATUS_NAME}}</span>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="products-list product-list-in-card">
                                                        <li class="item  pt-0">
                                                            <div class="product-info ml-0">
                                                                <div class="product-title">
                                                                    {{User.APPROVER_EMAIL}}
                                                                    <span class="d-block" ng-if="User.LAST_ACTION_TAKEN_DATE!=null">{{User.LAST_ACTION_TAKEN_DATE | toDate | date}}, {{User.LAST_ACTION_TAKEN_DATE | toDate | date:'H:mm'}}</span>
                                                                </div>

                                                            </div>
                                                        </li>
                                                        <li class="item">
                                                            <div class="product-info ml-0 font-12 custom-scrollbar" style="max-height:100px">
                                                                {{User.COMMENTS==null?'-':User.COMMENTS}}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-auto" ng-if="APL.showborder && !$last" ng-repeat-end><i class="far fa-angle-right text-grey mt-1"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade " ng-class="{'show active':TAB_FLAG==3}" id="custom-content-below-home" role="tabpanel" aria-labelledby="custom-content-below-home-tab">
        <div class="row">
            <div class="col-md-3 custom-scrollbar height-77vh stick-top">
                <div class="col-md-12 px-0 pb-1 sticky-top bg-white">
                    <form id="SearchForceForm" name="SearchForceForm" novalidate autocomplete="off">
                        <div class="search-form-group">
                            <input type="text" ng-model="ApprovalViewSearch.SEARCH_NAME_ALL" class="form-control" placeholder="Search by Item / Description / Request #" />
                            <button type="submit" class="btn btn-wenodo" 
                                     click-once
                                    ng-click="GET_APPROVAL_HEADERS_FOR_ADMIN(1,4,false)"></button>
                        </div>
                    </form>
                </div>
                <div class="detailed-card " ng-class="{'active':APL.PR_NUMBER==ApprovalViewSearch.ALL_REQUEST_DETAILS.PR_NUMBER}"
                     ng-repeat="APL in HEADERS_FOR_APPROVER_ADMIN_LIST"
                     ng-click="PURCHASE_REQUEST_ALL_APPROVAL_ADMIN_CLICK(APL)">
                    <div class="card-body">
                        <div class="row align-items-center height-100p">
                            <div class="col">
                                <span class="po-details text-limit-2 font-12">{{APL.PR_NUMBER}} | {{APL.ITEM_NAME}}</span>
                                <span class="po-supplier font-10 mt-2">{{APL.REQUESTOR_NAME}}</span>
                            </div>
                            <div class="col-auto text-right">
                                <span class="badge " ng-class="{'border-badge':APL.APPROVER_STATUS_ID==74,'badge-light-grey':APL.OVERALL_STATUS_ID==39, 'badge-light-green':APL.OVERALL_STATUS_ID==37,'badge-danger':APL.OVERALL_STATUS_ID==38 || APL.OVERALL_STATUS_ID==42}">{{APL.OVERALL_STATUS_NAME}}</span>
                                <span class="po-supplier font-10 mt-2">{{APL.BRANCH_NAME}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12" ng-show="GetAllData">
                    <button type="button" ng-click="GET_APPROVAL_HEADERS_FOR_ADMIN_LAZY_LOAD()" class="btn btn-block btn-w-default">
                        {{VIEWMORERECORD}}
                    </button>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row align-content-center mn-height-66vh" ng-show="HEADERS_FOR_APPROVER_ADMIN_LIST.length==0">
                    <div class="col-md-12 text-center">
                        <h5 class="text-muted">
                            <span class="d-block mb-3">
                                <img src="../../../E_Content/images/sorted.png" />
                            </span>
                            Everything's sorted!
                        </h5>
                    </div>
                </div>
                <div class="card-body" ng-show="HEADERS_FOR_APPROVER_ADMIN_LIST.length>0">
                    <div class="row">
                        <div class="col">
                            <h5 class="po-details font-14 ">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.PR_NUMBER}} | {{ApprovalViewSearch.ALL_REQUEST_DETAILS.ITEM_NAME}} </h5>
                        </div>
                        <div class="col-auto">
                            <button type="button" ng-click="PR_VALIDATION_FORCE_CLICK_FY(37,SELECTED_REQ_ALL)"
                                    ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 && CheckSubModuleAccess(141)" class="btn btn-wenodo">
                                Force Approve
                            </button>
                            <button type="button" ng-click="PR_VALIDATION_FORCE_CLICK_FY(38,SELECTED_REQ_ALL)"
                                    ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 && CheckSubModuleAccess(141)" class="btn btn-danger">
                                Force Reject
                            </button>
                            <button type="button" ng-click="POP_UPD_PURCHASE_REQUEST_BY_APPROVER('ALL')" ng-show="ApprovalData.ACTION_REQUIRED==1 && false" class="btn btn-wenodo">Update</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <span class="po-supplier"><span class="text-normal">By </span>{{ApprovalViewSearch.ALL_REQUEST_DETAILS.REQUESTOR_NAME}} <span class="text-normal">on</span> {{ApprovalViewSearch.ALL_REQUEST_DETAILS.PR_CREATED_DATE | date}}</span>
                            <span class="po-supplier"><span class="text-normal">Raised For</span> {{ApprovalViewSearch.ALL_REQUEST_DETAILS.BRANCH_NAME}} </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 pr-4">
                            <label class="text-bold mt-2">Description: <span class="po-supplier text-danger d-inline">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.URGENT_REQUEST?'Urgent':''}}</span></label>
                            <span class="d-block font-12">
                                {{ ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION==''?'-': ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION | limitTo:LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO">...</span>

                                <span class="btn btn-xs btn-wenodo d-inline-flex"
                                      ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO || ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO"
                                      ng-click="READ_MORE(ApprovalViewSearch.ALL_REQUEST_DETAILS,(ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?1:2))"
                                      data-toggle="tooltip"
                                      data-html="true"
                                      data-original-title="{{ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO?'Read More':'Hide'}}">
                                    <i ng-class="{'fa-minus':ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length==LIMIT_TO,'fa-plus':ApprovalViewSearch.ALL_REQUEST_DETAILS.DESCRIPTION.length>LIMIT_TO}" class="far "></i>
                                </span>


                            </span>
                            <label class="text-bold">Comments:</label>
                            <span class="d-block font-12">
                                {{ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS==''?'-': ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS | limitTo:COMMENTS_LIMIT_TO}}
                                <span ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO">...</span>
                                <span class="btn btn-xs btn-wenodo d-inline-flex" ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS.length>COMMENTS_LIMIT_TO" ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.ALL_REQUEST_DETAILS,1)" data-toggle="tooltip" data-html="true" data-original-title="Read More"><i class="far fa-plus"></i></span>
                                <span class="btn btn-xs btn-wenodo d-inline-flex" ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.COMMENTS.length==COMMENTS_LIMIT_TO" ng-click="READ_MORE_COMMENTS(ApprovalViewSearch.ALL_REQUEST_DETAILS,2)" data-toggle="tooltip" data-html="true" data-original-title="Hide"><i class="far fa-minus"></i></span>
                            </span>
                        </div>

                        <div class="col-md-4">
                            <label class="text-bold">Quantity:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.QUANTITY | number:2}} {{ApprovalViewSearch.ALL_REQUEST_DETAILS.UOM_NAME}}</span>
                            <label class="mt-2 text-bold">Expected Amount:</label>
                            <span class="po-supplier"> {{ApprovalViewSearch.ALL_REQUEST_DETAILS.EXPECTED_PRICE | number :2}} <span class="text-bold">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.CURRENCY_CODE}}</span></span>

                            <label class="mt-2 text-bold">Required Date:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.REQUIRED_DATE==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.REQUIRED_DATE=="" ?'-':ApprovalViewSearch.ALL_REQUEST_DETAILS.REQUIRED_DATE | date}}</span>

                            <label class="mt-2 text-bold">Suggested Supplier:</label>
                            <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.SUGGESTED_SUPPLIER==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.SUGGESTED_SUPPLIER=="" ?'-':ApprovalViewSearch.ALL_REQUEST_DETAILS.SUGGESTED_SUPPLIER  }}</span>


                            <label class="mt-2 text-bold">Attachments:</label>
                            <div ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.UploadedFiles == null || ApprovalViewSearch.ALL_REQUEST_DETAILS.UploadedFiles.length==0">No attachment</div>
                            <div class="file-block" ng-repeat="FILE in ApprovalViewSearch.ALL_REQUEST_DETAILS.UploadedFiles">
                                <div class="file-info">
                                    <i class="far fa-file-alt file-icon"></i>
                                    <span class="text-limit-1"> <a href="../P2PFiles/{{FILE.FILE_PATH}}{{FILE.SERVER_FILE_NAME}}" download="{{FILE.ORIGINAL_FILE_NAME}}">  {{FILE.ORIGINAL_FILE_NAME}} </a></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row  my-4" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID!=39 && CheckSubModuleAccess(134)">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Expected Amount </label>
                                <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE=="" ?'-':ApprovalViewSearch.ALL_REQUEST_DETAILS.APPROVER_EXPECTED_PRICE | number :2}}</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Project Name</label>
                                <div class="form-group">
                                    <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.PROJECT_NAME==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.PROJECT_NAME=="" ?'-':ApprovalViewSearch.ALL_REQUEST_DETAILS.PROJECT_NAME}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">GL Account </label>
                                <span class="po-supplier">{{ApprovalViewSearch.ALL_REQUEST_DETAILS.ACCOUNT_DETAILS==null || ApprovalViewSearch.ALL_REQUEST_DETAILS.ACCOUNT_DETAILS=="" ?'-':ApprovalViewSearch.ALL_REQUEST_DETAILS.ACCOUNT_DETAILS}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 && CheckSubModuleAccess(134)">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Expected Amount <span class="text-danger">*</span></label>
                                <input type="text"
                                       required
                                       class="form-control"
                                       only-digits
                                       maxlength="13"
                                       placeholder="Enter expected amount"
                                       name="APPROVER_EXPECTED_PRICE"
                                       ng-model="PurchaseRequestSearch.APPROVER_EXPECTED_PRICE"
                                       ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.APPROVER_EXPECTED_PRICE.$error.required || PurchaseRequestSearch.APPROVER_EXPECTED_PRICE==0 && RequestUpdForm.submitted}" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Project Name</label>
                                <div class="form-group">
                                    <select class="custom-select mw-150"
                                            name="PROJECT_MASTER_ID"
                                            ng-model="PurchaseRequestSearch.PROJECT_MASTER_ID"
                                            ng-change="CHANGE_PROJECT_fn()"
                                            ng-options="T.PROJECT_MASTER_ID as T.PROJECT_NAME for T in PROJECT_MASTER_LIST"
                                            ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.PROJECT_MASTER_ID.$error.required}">
                                        <option value="">-Select Project-</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">GL Account<span class="text-danger">*</span></label>
                                <div class="AddCustomScroll_Account">
                                    <input type="text" name="XERO_ACCOUNT_CODE{{$index}}"
                                           ng-model="PurchaseRequestSearch.ACCOUNT_DETAILS"
                                           ng-change="SetAccountPRValues(PRL,$index);"
                                           typeahead-on-select="CHANGE_BUDGET_fn($item, 3, $label)"
                                           uib-typeahead="Acct.CODE + ' - ' + Acct.NAME  for Acct in XERO_ACCOUNT_CODES | filter:$viewValue"
                                           typeahead-loading="loading" typeahead-no-results="noResults"
                                           class="form-control"
                                           autocomplete="off"
                                           required
                                           placeholder="Type to select GL Account..."
                                           ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.XERO_ACCOUNT_CODE{{$index}}.$error.required || CREATE_REQ_FORM.submitted && CREATE_REQ_FORM.IS_ACCOUNT_VALID}" />
                                </div>
                                <small ng-show="PurchaseRequestSearch.IS_ACCOUNT_VALID" class="text-red text-bold">Invalid GL Account</small>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-12" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID!=38 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=42 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=37">
                        <div class="card-header w-100">
                            <h5 class="card-title mt-1">
                                Budget 
                                <span ng-show="P2P_ALL_BUDGET_MASTER_LIST.length>0"> {{SELECTED_REQ_ALL.OVERALL_STATUS_ID}} ({{ApprovalViewSearch.BUDGET_NAME}}) </span>
                            </h5>
                            <div class="card-tools">
                                <button type="button"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 || SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 && P2P_ALL_BUDGET_MASTER_LIST.length>0"
                                        ng-click="CHANGE_BUDGET_fn(ApprovalViewSearch,3)"
                                        class="btn btn-transparent-wenodo ml-2 border  float-right">
                                    Refresh Budget
                                </button>
                                <button type="button"
                                        ng-show="false && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=39 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=38 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=42"
                                        ng-click="GET_P2P_BUDGET_SNAPSHOT(ApprovalViewSearch.ALL_REQUEST_DETAILS);ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET=!ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET;"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    View Requisition Budget
                                </button>
                            </div>
                        </div>
                        <div class="col-md-12 mt-2" ng-show="P2P_ALL_BUDGET_MASTER_LIST.length>0">
                            <span class="po-amount">The following budgets would be affected by the approval of the request.</span>
                        </div>
                        <div class="col-md-12 text-center mt-2"
                             ng-show="P2P_ALL_BUDGET_MASTER_LIST.length==0">
                            <div class="alert bg-custom-blue">{{BUDGET_TEXT_VALIDATION}}</div>
                        </div>
                        <div class="card-body p-0 mt-2" ng-show="P2P_ALL_BUDGET_MASTER_LIST.length>0">
                            <div class="table-responsive custom-scrollbar">
                                <table class="table table-head-fixed table-hover">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>GL Account </th>
                                            <th>Period</th>
                                            <th class="text-right">Total</th>
                                            <th class="text-right">Remaining</th>
                                            <th class="text-right">Consumed</th>
                                            <th class="text-right">Booked</th>
                                            <th class="text-right">Credit Notes</th>
                                            <th class="text-right">Current</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="BD in P2P_ALL_BUDGET_MASTER_LIST">
                                        <tr>
                                            <td rowspan="3">{{BD.GLACCOUNT_NAME}}</td>

                                            <td colspan="7" ng-if="BD.DB_ACCOUNT_ID==0" class="text-align-center text-bold">There is no budget allocated in this GL Account</td>
                                        </tr>
                                        <tr ng-if="BD.DB_ACCOUNT_ID!=0" ng-repeat="BL in BD.BUDGET_DETAILS_LIST" ng-init="BL.CURRENT_PO_CUSTOM=0;"
                                            ng-click="VIEW_BUDGET_fn(BD,ApprovalViewSearch.REQUEST_DETAILS.PR_CREATED_DATE,PurchaseRequestSearch.PROJECT_MASTER_ID,ApprovalViewSearch,PurchaseRequestSearch,'PR_ALL')">
                                            <td>{{BL.PERIOD}}</td>
                                            <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                            <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                                {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT_PO_CUSTOM*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2}}
                                                <span ng-show="false">
                                                    {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0 && BD.BUDGET_DETAILS_LIST.length==BL.LINE_ID?true:BD.IS_OVER_BUDGET?true:false)}}
                                                </span>
                                            </td>
                                            <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                            <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                            <td class="text-right">
                                                <span ng-show="BL.MEMO==0">{{BL.MEMO*-1 | number :2}}</span><span ng-show="BL.MEMO!=0">({{BL.MEMO*-1 | number :2}})</span>
                                            </td>
                                            <td class="text-right">
                                                <span ng-show="false">{{(BL.CURRENT_PO_CUSTOM=PurchaseRequestSearch.APPROVER_EXPECTED_PRICE>0?PurchaseRequestSearch.APPROVER_EXPECTED_PRICE:0)}}</span>
                                                {{BL.CURRENT_PO_CUSTOM | number:2}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="alert alert-warning-red" ng-show="(P2P_ALL_BUDGET_MASTER_LIST | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This Requisition is going over budget.
                        </div>
                    </div>
                    <div class="col-md-12" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==37">
                        <div class="card-header w-100">
                            <h5 class="card-title mt-1">
                                Requisition Budget (This shows the budget when the requisition was posted) <span ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length>0"></span>
                            </h5>
                            <div class="card-tools">
                                <button type="button" ng-show="false" class="btn btn-transparent-wenodo border"
                                        ng-click="ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET=!ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET">
                                    <i class="fa fa-close"
                                       data-toggle="tooltip" data-html="true"
                                       data-original-title="Hide"></i>
                                </button>
                                <button type="button"
                                        ng-show="false && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=39 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=38 && SELECTED_REQ_ALL.OVERALL_STATUS_ID!=42"
                                        ng-click="GET_P2P_BUDGET_SNAPSHOT(ApprovalViewSearch.ALL_REQUEST_DETAILS);ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET=!ApprovalViewSearch.ALL_REQUEST_DETAILS.SHOW_REQ_BUDGET;"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    View Requisition Budget
                                </button>
                            </div>
                        </div>
                        <div class="col-md-12 text-center mt-2" ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length==0" empty-grid> </div>
                        <div class="card-body p-0 mt-2" ng-show="ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST.length>0">
                            <div class="table-responsive custom-scrollbar">
                                <table class="table table-head-fixed table-hover">
                                    <thead class="bg-wenodo-border">
                                        <tr>
                                            <th>GL Account </th>
                                            <th>Period</th>
                                            <th class="text-right">Total</th>
                                            <th class="text-right">Remaining</th>
                                            <th class="text-right">Consumed</th>
                                            <th class="text-right">Booked</th>
                                            <th class="text-right">Credit Notes</th>

                                            <th class="text-right" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39 || true">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-repeat="BD in ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | unique:'ACCOUNT_ID'">
                                        <tr><td rowspan="3">{{BD.ACCOUNT_DETAILS}}</td></tr>
                                        <tr ng-repeat="BL in ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST | filter:{ACCOUNT_ID:BD.ACCOUNT_ID}:true">
                                            <td>{{BL.PERIOD}}</td>
                                            <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                            <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                                {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2 }}
                                                <span ng-show="false">
                                                    {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0 && BD.BUDGET_DETAILS_LIST.length==BL.LINE_ID?true:BD.IS_OVER_BUDGET?true:false)}}
                                                </span>
                                            </td>
                                            <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                            <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                            <td class="text-right">
                                                <span ng-show="BL.MEMO==0">{{BL.MEMO*-1 | number :2}}</span><span ng-show="BL.MEMO!=0">({{BL.MEMO*-1 | number :2}})</span>
                                            </td>
                                            <td class="text-right" ng-show="SELECTED_REQ_ALL.OVERALL_STATUS_ID==39  || true">{{BL.CURRENT | number:2}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="alert alert-warning-red" ng-show="(ApprovalViewSearch.ALL_REQUEST_DETAILS.P2P_SNAP_SHOT_MASTER_LIST  | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This Requisition is going over budget.
                        </div>
                    </div>
                    <div class="card-header"><h5 class="card-title">Approval Workflow</h5></div>
                    <div class="row align-items-center mt-3">
                        <div class="col d-flex custom-scrollbar horizontal_scroll" style="min-height:350px;">
                            <div class="col-md-2" ng-repeat-start="APL in APPROVAL_HEADERS_CHAIN_LIST  | unique:'APPROVAL_CHAIN_GROUP_ID'"
                                 ng-init="InitiateApprover(APL)">
                                <div class="row pl-2">
                                    <span ng-show="false">{{APL.APL_INDEX=$index+1}}</span>
                                    <div class="col-md-12 pl-1">
                                        <button type="button" class="btn btn-w-default w-100 text-nowrap"
                                                ng-class="{'active':APL.STEP_ACTIVE==1, 'active-approved':APL.SEQUENCE_APPROVED}">
                                            {{APL.GROUP_NAME}}
                                        </button>
                                    </div>
                                    <span class="w-100 z-index-997">
                                        Approval condition: {{APL.ANY_ALL_FLAG==0?'All':'Any'}} <span ng-show="APL.ANY_ALL_FLAG>0"> of {{APL.ANY_ALL_FLAG}}</span>
                                    </span>
                                    <div class="col-auto pl-1 mt-2"
                                         ng-repeat="User in APPROVAL_HEADERS_CHAIN_LIST | filter:{APPROVAL_CHAIN_GROUP_ID:APL.APPROVAL_CHAIN_GROUP_ID}"
                                         ng-init="InitiateNameApprover(User,APL)" on-finish-render="ngRepeatFinishedRender">
                                        <div class="sec-center mt-1">
                                            <span ng-show="false"> {{ User.ACTION_REQUIRED==1?APL.STEP_ACTIVE=true :''}}</span>
                                            <input class="dropdown" type="checkbox" id="dropdownAll{{$index}}{{APL.APL_INDEX}}" name="dropdown" />
                                            <label class="name-badge-short cursor-pointer"
                                                   ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-pending': User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}"
                                                   for="dropdownAll{{$index}}{{APL.APL_INDEX}}">{{User.SHORT_NAME}}</label>
                                            <div class="section-dropdown">
                                                <div class="card-header">
                                                    <div class="name-badge d-inline">{{User.SHORT_NAME}}</div>
                                                    <span class="mt-2 ml-2">{{User.APPROVER_NAME}}</span>
                                                    <span class="badge  text-white float-right"
                                                          ng-class="{'name-badge-approved':User.STATUS_ID==37,'name-badge-pending':User.STATUS_ID==39,'name-badge-rejected': User.STATUS_ID==38 || User.STATUS_ID==42,'name-badge-auto-approved': User.STATUS_ID==41,'name-badge-no-action-required': User.STATUS_ID==74}">{{User.STATUS_NAME}}</span>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="products-list product-list-in-card">
                                                        <li class="item  pt-0">
                                                             <div class="product-title">
                                                                    {{User.APPROVER_EMAIL}}
                                                                 <span class="d-block" ng-if="User.LAST_ACTION_TAKEN_DATE!=null">{{User.LAST_ACTION_TAKEN_DATE | toDate | date}}, {{User.LAST_ACTION_TAKEN_DATE | toDate | date:'H:mm'}}</span>
                                                                </div>

                                                        </li>
                                                        <li class="item">
                                                            <div class="product-info ml-0 font-12 custom-scrollbar" style="max-height:100px">
                                                                {{User.COMMENTS==null?'-':User.COMMENTS}}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-auto" ng-if="APL.showborder && !$last" ng-repeat-end><i class="far fa-angle-right text-grey mt-1"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade show" id="Approved_Reject_POP">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title d-flex">
                    <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FLAG==37">Approval&nbsp; </span>
                    <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FLAG==38">Rejection&nbsp; </span> Comment  <span class="text-danger">
                        <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FLAG==38">&nbsp;* </span>
                    </span>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center" ng-show="OTP_VALID_CHECK=='1' && NXT_APPROVAL_HEADER_STATUS_ID=='' && ALLOW_SUBMIT">
                    <div class="prompt">Enter OTP</div>
                    <form method="get" class="digit-group" data-group-name="digits" data-autosubmit="false" autocomplete="off">
                        <input type="text" id="digit-1" ng-model="ApprovalViewSearch.digit1" name="digit-1" data-next="digit-2" />
                        <input type="text" id="digit-2" ng-model="ApprovalViewSearch.digit2" name="digit-2" data-next="digit-3" data-previous="digit-1" />
                        <input type="text" id="digit-3" ng-model="ApprovalViewSearch.digit3" name="digit-3" data-next="digit-4" data-previous="digit-2" />
                        <span class="splitter">&ndash;</span>
                        <input type="text" id="digit-4" ng-model="ApprovalViewSearch.digit4" name="digit-4" data-next="digit-5" data-previous="digit-3" />
                        <input type="text" id="digit-5" ng-model="ApprovalViewSearch.digit5" name="digit-5" data-next="digit-6" data-previous="digit-4" />
                        <input type="text" id="digit-6" ng-model="ApprovalViewSearch.digit6" name="digit-6" data-previous="digit-5" />
                    </form>
                    <span class="d-block text-danger font-14 semibold mb-2"><em>{{MESSAGE_OTP_ERROR}}</em></span>
                    <span class="d-block text-success font-14 semibold mb-2"><em>{{MESSAGE_OTP_SEND}}</em></span>
                    <button type="button" ng-click="RESEND_GENERATE_APPROVAL_OTP()" class="btn btn-w-default">Resend OTP</button>
                </div>
                <form id="ApprovalForm" name="ApprovalForm" ng-show="!ALLOW_SUBMIT">
                    <div class="row">
                        <div class="col-md-6 text-center" ng-show="false">
                            <div class="info-box bg-headers">
                                <span class="info-box-icon"><i class="fad fa-check-square text-success"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text semibold">Approved  / Selected  Invoices</span>
                                    <span class="info-box-number text-nowrap">
                                        {{ApprovalViewSearch.SELECTED_INVOICES}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 text-center" ng-show="false">
                            <div class="info-box bg-headers">
                                <span class="info-box-icon"><i class="fad fa-times-square text-danger"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text semibold">Rejected / Unselected Invoice</span>
                                    <span class="info-box-number text-nowrap">
                                        {{ApprovalViewSearch.UNSELECTED_INVOICE}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <textarea name="COMMENT"
                                      ng-required="ApprovalViewSearch.APPROVE_REJECT_FLAG==38"
                                      class="form-control"
                                      ng-class="{'error':ApprovalForm.submitted && ApprovalForm.COMMENT.$error.required}"
                                      rows="8"
                                      placeholder="Type your valuable comment"
                                      maxlength="2000"
                                      ng-model="ApprovalViewSearch.COMMENT">
                           </textarea>
                            <span class="d-block text-gray text-xs semibold">{{2000 - ApprovalViewSearch.COMMENT.length}} Character Remaining </span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" ng-show="!ALLOW_SUBMIT">
                <button type="button"
                        ng-click="APPROVE_CLICK_FY()"
                        click-once
                        ng-disabled="OTP_VALID_CHECK=='1' && NXT_APPROVAL_HEADER_STATUS_ID=='' && ALLOW_SUBMIT"
                        class="btn btn-sm btn-wenodo">
                    Submit
                </button>
                <button type="button" class="btn btn-sm btn-w-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal fade show" id="Approved_Reject_FROCE_POP">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title d-flex">
                    <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FROCE_FLAG==37">Approval&nbsp; </span>
                    <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FROCE_FLAG==38">Rejection&nbsp; </span> Comment  <span class="text-danger">
                        <span ng-show="ApprovalViewSearch.APPROVE_REJECT_FROCE_FLAG==38">&nbsp;* </span>
                    </span>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center" ng-show="OTP_VALID_CHECK=='1' && NXT_APPROVAL_HEADER_STATUS_ID=='' && ALLOW_FORCE_SUBMIT">
                    <div class="prompt">Enter OTP</div>
                    <form method="get" class="digit-group" data-group-name="digits" data-autosubmit="false" autocomplete="off">
                        <input type="text" id="digit-1" ng-model="ApprovalViewSearch.digit1" name="digit-1" data-next="digit-2" />
                        <input type="text" id="digit-2" ng-model="ApprovalViewSearch.digit2" name="digit-2" data-next="digit-3" data-previous="digit-1" />
                        <input type="text" id="digit-3" ng-model="ApprovalViewSearch.digit3" name="digit-3" data-next="digit-4" data-previous="digit-2" />
                        <span class="splitter">&ndash;</span>
                        <input type="text" id="digit-4" ng-model="ApprovalViewSearch.digit4" name="digit-4" data-next="digit-5" data-previous="digit-3" />
                        <input type="text" id="digit-5" ng-model="ApprovalViewSearch.digit5" name="digit-5" data-next="digit-6" data-previous="digit-4" />
                        <input type="text" id="digit-6" ng-model="ApprovalViewSearch.digit6" name="digit-6" data-previous="digit-5" />
                    </form>
                    <span class="d-block text-danger font-14 semibold mb-2"><em>{{MESSAGE_OTP_ERROR}}</em></span>
                    <span class="d-block text-success font-14 semibold mb-2"><em>{{MESSAGE_OTP_SEND}}</em></span>
                    <button type="button" ng-click="RESEND_GENERATE_APPROVAL_OTP()" class="btn btn-w-default">Resend OTP</button>
                </div>
                <form id="ApprovalForceForm" name="ApprovalForceForm" ng-show="!ALLOW_FORCE_SUBMIT">
                    <div class="row">
                        <div class="col-md-6 text-center" ng-show="false">
                            <div class="info-box bg-headers">
                                <span class="info-box-icon"><i class="fad fa-check-square text-success"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text semibold">Approved  / Selected  Invoices</span>
                                    <span class="info-box-number text-nowrap">
                                        {{ApprovalViewSearch.SELECTED_INVOICES}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 text-center" ng-show="false">
                            <div class="info-box bg-headers">
                                <span class="info-box-icon"><i class="fad fa-times-square text-danger"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text semibold">Rejected / Unselected Invoice</span>
                                    <span class="info-box-number text-nowrap">
                                        {{ApprovalViewSearch.UNSELECTED_INVOICE}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <textarea name="FROCE_COMMENT"
                                      ng-required="ApprovalViewSearch.APPROVE_REJECT_FLAG==38"
                                      class="form-control"
                                      ng-class="{'error':ApprovalForm.submitted && ApprovalForm.COMMENT.$error.required}"
                                      rows="8"
                                      placeholder="Type your valuable comment"
                                      maxlength="2000"
                                      ng-model="ApprovalViewSearch.FORCE_COMMENTS">
                           </textarea>
                            <span class="d-block text-gray text-xs semibold">{{2000 - ApprovalViewSearch.FROCE_COMMENT.length}} Character Remaining </span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" ng-show="!ALLOW_FORCE_SUBMIT">
                <button type="button"
                        ng-click="CLICK_APPROVE_FORCE_Fn(ApprovalViewSearch)"
                        click-once
                        ng-disabled="OTP_VALID_CHECK=='1' && NXT_APPROVAL_HEADER_STATUS_ID=='' && ALLOW_FORCE_SUBMIT"
                        class="btn btn-sm btn-wenodo">
                    Submit
                </button>
                <button type="button" class="btn btn-sm btn-w-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal fade show" id="Edit_Acount">
    <form id="RequestUpdForm" name="RequestUpdForm" novalidate>
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Update Request {{PurchaseRequestSearch.PR_NUMBER}}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body custom-scrollbar">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="d-block">Item Name</label>
                                <span class="po-details">{{PurchaseRequestSearch.ITEM_NAME}}</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Branch Name </label>
                                {{PurchaseRequestSearch.BRANCH_NAME}}
                            </div>
                        </div>
                        <div class="col-md-12 border-top border-bottom">
                            <div class="form-group mt-3">
                                <label class="d-block">Description </label>
                                <span class="text-muted text-sm">{{PurchaseRequestSearch.DESCRIPTION}}</span>
                            </div>
                        </div>
                        <div class="col-md-4 mt-2">
                            <div class="form-group">
                                <label class="d-block">Quantity</label>
                                {{PurchaseRequestSearch.QUANTITY  | number :2}}
                            </div>
                        </div>
                        <div class="col-md-4 mt-2">
                            <div class="form-group">
                                <label class="d-block">UOM</label>
                                {{PurchaseRequestSearch.UOM_NAME=='' || PurchaseRequestSearch.UOM_NAME==null?'-':PurchaseRequestSearch.UOM_NAME}}
                            </div>
                        </div>
                        <div class="col-md-4 mt-2"></div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Expected Amount <span class="text-danger">*</span></label>
                                <input type="text"
                                       required
                                       class="form-control"
                                       only-digits
                                       maxlength="13"
                                       placeholder="Enter expected amount"
                                       name="APPROVER_EXPECTED_PRICE"
                                       ng-model="PurchaseRequestSearch.APPROVER_EXPECTED_PRICE"
                                       ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.APPROVER_EXPECTED_PRICE.$error.required || PurchaseRequestSearch.APPROVER_EXPECTED_PRICE==0 && RequestUpdForm.submitted}" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Project Name</label>
                                <div class="form-group">
                                    <select class="custom-select mw-150"
                                            name="PROJECT_MASTER_ID"
                                            ng-model="PurchaseRequestSearch.PROJECT_MASTER_ID"
                                            ng-change="CHANGE_PROJECT_fn()"
                                            ng-options="T.PROJECT_MASTER_ID as T.PROJECT_NAME for T in PROJECT_MASTER_LIST"
                                            ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.PROJECT_MASTER_ID.$error.required}">
                                        <option value="">-Select Project-</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">GL Account <span class="text-danger">*</span></label>
                                <div class="AddCustomScroll_Account">
                                    <input type="text" name="XERO_ACCOUNT_CODE{{$index}}"
                                           ng-model="PurchaseRequestSearch.ACCOUNT_DETAILS"
                                           ng-change="SetAccountPRValues(PRL,$index);"
                                           ng-blur="CHANGE_BUDGET_fn(PRL)"
                                           uib-typeahead="Acct.CODE + ' - ' + Acct.NAME  for Acct in XERO_ACCOUNT_CODES | filter:$viewValue"
                                           typeahead-loading="loading" typeahead-no-results="noResults"
                                           class="form-control"
                                           autocomplete="off"
                                           required
                                           placeholder="Type to select GL Account..."
                                           ng-class="{'error':RequestUpdForm.submitted && RequestUpdForm.XERO_ACCOUNT_CODE{{$index}}.$error.required || CREATE_REQ_FORM.submitted && CREATE_REQ_FORM.IS_ACCOUNT_VALID}" />
                                </div>
                                <small ng-show="PurchaseRequestSearch.IS_ACCOUNT_VALID" class="text-red text-bold">Invalid GL Account</small>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Suggested Suppliers</label>
                                {{PurchaseRequestSearch.SUGGESTED_SUPPLIER==null?'-':PurchaseRequestSearch.SUGGESTED_SUPPLIER}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Required Date</label>

                                {{PurchaseRequestSearch.REQUIRED_DATE ==null?'-':(PurchaseRequestSearch.REQUIRED_DATE | date)}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="d-block">Urgent Request</label>
                                <span> {{PurchaseRequestSearch.URGENT_REQUEST?'Yes':'No'}}</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="d-block">Comment </label>
                                <blockquote class="text-sm">{{PurchaseRequestSearch.COMMENTS ==null?'-':PurchaseRequestSearch.COMMENTS}}</blockquote>
                            </div>
                        </div>
                        <div class="col-md-12 mt-1">
                            <label class="d-block">Attachment(s) </label>
                            <div class="text-sm" ng-show="PurchaseRequestSearch.UploadedFiles ==null || PurchaseRequestSearch.UploadedFiles.length==0">No Attachment</div>
                            <div class="row">
                                <div class="col-md-4" ng-repeat="file in PurchaseRequestSearch.UploadedFiles">
                                    <div class="file-block">
                                        <div class="file-info">
                                            <i class="far fa-file-alt file-icon"></i>
                                            <a href="/P2PFiles/{{file.FILE_PATH}}{{file.SERVER_FILE_NAME}}" download="/P2PFiles/{{file.FILE_PATH}}{{file.SERVER_FILE_NAME}}"> <span class="text-limit-1">{{file.ORIGINAL_FILE_NAME}} </span></a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-md-12 ">
                    <div data-ng-show="RequestUpdForm.submitted && RequestUpdForm.$invalid" class="form-group has-error errormessage badge badge-light-red w-100 p-3">
                        <span class="help-block errormessageline" style="padding-left:0px;"><i class="fa fa-exclamation-triangle"></i> - Please provide the mandatory details to submit(marked in red).</span>
                    </div>
                    <div id="divInvlidUser" class="hideshowdiv" data-ng-show="RequestUpdForm.$valid">
                        <span class="help-block">{{InvalidUser}}</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" ng-click="UPD_PURCHASE_REQUEST_BY_APPROVER()" class="btn btn-wenodo">Save</button>
                    <button type="button" class="btn btn-w-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </form>
</div>
