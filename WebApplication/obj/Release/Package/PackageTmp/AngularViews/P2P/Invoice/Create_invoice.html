<div ng-controller="Create_Invoice_Controller">
    <form name="INVOICE_FORM" id="INVOICE_FORM" novalidate>
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    {{(BRANCH_LOGIN_LIST | filter:{BRANCH_ID:Invoice_Search.BRANCH_ID})[0].BRANCH_NAME}}
                    <i ng-show="BRANCH_LOGIN_LIST.length>1" class="far fa-edit cursor-pointer text-blue" data-toggle="modal" data-target="#select_branch"></i>
                </h5>
                <div class="card-tools ml-auto">
                    <ul class="nav nav-pills">
                        <li class="nav-item"><button type="button" click-once ng-click="INS_UPD_INVOICES()" class="btn btn-wenodo mr-2">Submit</button></li>
                        <li class="nav-item"><button type="button" click-once ng-click="$parent.TAB_CLICK_AP_FY(ACTIVE_TAB_FLAG,Invoice_Search)" class="btn btn-w-default mr-2" data-toggle="tooltip" data-html="true" data-original-title="Back">Back</button></li>
                        <li class="nav-item"><button type="button" click-once ng-click="RESET_INVOICE()" ng-show="SELECTED_INVOICE_DETAILS==''" class="btn btn-transparent-wenodo mr-2" data-toggle="tooltip" data-html="true" data-original-title="Reset"><i class="fad fa-undo-alt"></i></button></li>

                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="form-group" id="AddCustomScroll_SHD">
                            <label>Contact <span class="text-danger">*</span></label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{Invoice_Search.SUPPLIER_NAME}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <input type="text" name="SUPPLIER_NAME_BOX"
                                       ng-model="Invoice_Search.SUPPLIER_NAME"
                                       ng-change="SetValues(Supplier,$index)"
                                       uib-typeahead="Supplier.SUPPLIER_NAME for Supplier in INVOICE_SUPPLIER_LIST | filter:$viewValue"
                                       typeahead-loading="loading" typeahead-no-results="noResults"
                                       class="form-control form-control-sm" autocomplete="off"
                                       required
                                       ng-disabled="DISABLE_FIELD"
                                       placeholder="Type to select Supplier Name..."
                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.SUPPLIER_NAME_BOX.$error.required}" />
                            </span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Date <span class="text-danger">*</span></label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{Invoice_Search.INVOICE_DATE}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <input type="text" class="form-control dateinput"
                                       name="DATE"
                                       placeholder="Select date"
                                       ng-model="Invoice_Search.INVOICE_DATE"
                                       ng-disabled="DISABLE_FIELD"
                                       ng-value="Invoice_Search.INVOICE_DATE | date"
                                       required
                                       readonly
                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.DATE.$error.required}" />
                            </span>
                        </div>

                    </div>
                    <div class="col">
                        <div class="form-group" ng-init="$parent.DateInputLoad('EDIT_INVOICE')">
                            <label>Budget Consumption Date <span class="text-danger">*</span></label>
                            <input type="text" class="form-control dateinput"
                                   name="BUDGET_DATE"
                                   placeholder="Select Budget Consumption date"
                                   ng-model="Invoice_Search.BUDGET_DATE"
                                   ng-value="Invoice_Search.BUDGET_DATE | date"
                                   ng-change="ChangeBudgetDate()"
                                   required
                                   readonly
                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.BUDGET_DATE.$error.required}" />
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Due Date <span class="text-danger">*</span></label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{Invoice_Search.DUE_DATE}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <input type="text" class="form-control dateinput"
                                       name="DUE_DATE"
                                       placeholder="Select due date"
                                       ng-model="Invoice_Search.DUE_DATE"
                                       ng-disabled="DISABLE_FIELD"
                                       ng-required="!DISABLE_FIELD"
                                       ng-value="Invoice_Search.DUE_DATE | date"
                                       required
                                       readonly
                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.DUE_DATE.$error.required}" />
                            </span>
                        </div>
                    </div>

                    <div class="col">
                        <div class="form-group">
                            <label>Invoice Number <span class="text-danger">*</span></label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{Invoice_Search.INVOICE_NUMBER}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <input type="text" class="form-control"
                                       name="INVOICE_NUMBER"
                                       required
                                       ng-disabled="DISABLE_FIELD"
                                       placeholder="Enter Invoice Number"
                                       ng-model="Invoice_Search.INVOICE_NUMBER"
                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.INVOICE_NUMBER.$error.required}" />
                            </span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Reference</label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{Invoice_Search.REFERENCE==null || Invoice_Search.REFERENCE==""?'-':Invoice_Search.REFERENCE}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <input type="text" class="form-control"
                                       name="REFERENCE"
                                       ng-disabled="DISABLE_FIELD"
                                       placeholder="Enter reference"
                                       ng-model="Invoice_Search.REFERENCE"
                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.REFERENCE.$error.required}" />
                            </span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Project</label>
                            <select class="custom-select mw-150"
                                    name="PROJECT_MASTER_ID"
                                    ng-model="Invoice_Search.PROJECT_MASTER_ID"
                                    ng-change="Fn_CHANGE_PROJECT()"
                                    ng-options="T.PROJECT_MASTER_ID as T.PROJECT_NAME for T in INVOICE_PROJECT_MASTER_LIST">
                                <option value="">-Select Project-</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Themes</label>
                            <span ng-show="DISABLE_FIELD" class="d-block text-bold font-14">{{(INVOICE_XERO_BRANDING_THEMES_LIST | filter:{'XERO_BRANDING_THEME_ID':Invoice_Search.XERO_BRANDING_THEME_ID})[0].NAME}}</span>
                            <span ng-show="!DISABLE_FIELD">
                                <select class="custom-select mw-150"
                                        name="XERO_BRANDING_THEMES_ID"
                                        ng-disabled="DISABLE_FIELD"
                                        ng-model="Invoice_Search.XERO_BRANDING_THEME_ID"
                                        ng-options="T.XERO_BRANDING_THEME_ID as T.NAME for T in INVOICE_XERO_BRANDING_THEMES_LIST"
                                        ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.XERO_BRANDING_THEMES_ID.$error.required}">
                                    <option value="">-Select Theme-</option>
                                </select>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 mt-3">
                        <h5 class="card-title mt-4">Line Items</h5>
                        <div class="row">
                            <div class="col-auto font-11 mt-2 ml-auto">
                            </div>
                            <div class="col-auto">
                                <label class=""> </label>
                                <div class="form-inline mb-2" ng-show="Invoice_Search.BASE_CURRENCY_ID!=Invoice_Search.INVOICE_CURRENCY_ID">
                                    <label class="mr-2">1  &nbsp;{{Invoice_Search.BASE_CURRENCY_NAME }} = </label>
                                    <input type="text"
                                           class="form-control"
                                           name="CURRENCY_CONVER"
                                           placeholder="Enter value"
                                           ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                           maxlength="10"
                                           ng-disabled="DISABLE_FIELD"
                                           ng-required="Invoice_Search.BASE_CURRENCY_ID!=Invoice_Search.INVOICE_CURRENCY_ID"
                                           ng-model="Invoice_Search.BASE_TO_INVOICE_CONVERSION_RATE"
                                           ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.CURRENCY_CONVER.$error.required}" />
                                    <!--<label class="mr-2">  &nbsp;{{Invoice_Search.INVOICE_CURRENCY_NAME }} </label>-->
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class=" mb-2">
                                    <label class="">Invoice Currency </label>
                                    <select class="custom-select mw-150"
                                            name="CURRENCY_ID"
                                            ng-disabled="DISABLE_FIELD"
                                            ng-model="Invoice_Search.INVOICE_CURRENCY_ID"
                                            ng-change="CHANGE_CURRENCY()"
                                            ng-options="T.CURRENCY_ID as T.DISPLAY_TEXT +'-' + T.CURRENCY_NAME for T in INVOICE_CURRENCY_LIST"
                                            ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.CURRENCY_ID.$error.required}"></select>
                                </div>
                            </div>

                            <div class="col-auto">
                                <div class=" mb-2">
                                    <label class="">Amounts are </label>
                                    <select class="custom-select mw-150"
                                            name="TAX_TYPE"
                                            ng-disabled="DISABLE_FIELD"
                                            ng-model="Invoice_Search.TAX_TYPE"
                                            ng-options="T.ID as T.NAME for T in INVOICE_TAX_TYPE"
                                            ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.TAX_TYPE.$error.required}"></select>
                                </div>
                            </div>


                        </div>
                        <div class="table-responsive" style="overflow-x:visible">
                            <table class="table table-head-fixed table-hover table-form table-bordered">
                                <thead class="bg-wenodo-border">
                                    <tr>
                                        <th width="15%">Item <span class="text-danger">*</span></th>
                                        <th width="20%">Description <span class="text-danger">*</span></th>
                                        <th>Quantity <span class="text-danger">*</span></th>
                                        <th>Unit Price <span class="text-danger">*</span></th>
                                        <th>UOM </th>
                                        <th width="5%">Disc %</th>
                                        <th>GL Account <span class="text-danger">*</span></th>
                                        <th>Tax Rate <span class="text-danger">*</span></th>
                                        <th class="text-right">Tax</th>
                                        <th class="text-right">Amount</th>
                                        <th ng-repeat="TrackingCat in INVOICE_XERO_TRACKING_CATEGORIES track by $index">{{TrackingCat.FIELD_NAME}}</th>
                                        <th width="3%" class="text-center"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="PRL in INVOICE_ITEM_LIST" ng-init="InitiateEditItemList(PRL,1);" on-finish-render="ngRepeatFinishedInvoiceActionRender">
                                        <td>
                                            <span ng-show="false">
                                                {{PRL.LINE_NO=($index+1)}}
                                            </span>
                                            <input type="text"
                                                   name="ITEM_NAME{{$index}}"
                                                   class="hidden-input"
                                                   required
                                                   ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                   maxlength="200"
                                                   ng-disabled="DISABLE_FIELD"
                                                   placeholder="Enter item name"
                                                   ng-required="!DISABLE_FIELD"
                                                   ng-model="PRL.ITEM_NAME"
                                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.ITEM_NAME{{$index}}.$error.required}" />
                                        </td>
                                        <td>
                                            <textarea class="hidden-input scroll"
                                                      name="DESCRIPTION{{$index}}"
                                                      required
                                                      id="text"
                                                      ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                      maxlength="2000"
                                                      ng-disabled="DISABLE_FIELD"
                                                      onInput="this.parentNode.dataset.replicatedValue = this.value"
                                                      placeholder="Enter description"
                                                      ng-model="PRL.DESCRIPTION"
                                                      ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.DESCRIPTION{{$index}}.$error.required}"></textarea>
                                        </td>
                                        <td>
                                            <input type="text" class="hidden-input"
                                                   name="QUANTITY{{$index}}"
                                                   only-digits
                                                   ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                   placeholder="Enter QTY."
                                                   ng-disabled="DISABLE_FIELD"
                                                   maxlength="13"
                                                   required
                                                   ng-model="PRL.QUANTITY"
                                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.QUANTITY{{$index}}.$error.required}" />
                                        </td>
                                        <td>
                                            <input type="text" class="hidden-input"
                                                   only-digits
                                                   required
                                                   ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                   maxlength="13"
                                                   ng-disabled="DISABLE_FIELD"
                                                   placeholder="Enter unit price"
                                                   name="UNIT_PRICE{{$index}}"
                                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.UNIT_PRICE{{$index}}.$error.required}"
                                                   ng-model="PRL.UNIT_PRICE" />
                                        </td>
                                        <td>
                                            <input type="text" class="hidden-input"
                                                   name="UOM_NAME{{$index}}"
                                                   maxlength="30"
                                                   ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                   placeholder="Enter UOM"
                                                   ng-disabled="DISABLE_FIELD"
                                                   ng-model="PRL.UOM_NAME"
                                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.UOM_NAME{{$index}}.$error.required}" />
                                        </td>
                                        <td>
                                            <input type="text" class="hidden-input"
                                                   name="DISCOUNT_PERCENT{{$index}}"
                                                   only-digits
                                                   maxlength="4"
                                                   ng-style="DISABLE_FIELD==true && {'background':'none'}"
                                                   ng-disabled="DISABLE_FIELD"
                                                   placeholder="Enter discount"
                                                   ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.DISCOUNT_PERCENT{{$index}}.$error.required}"
                                                   ng-model="PRL.DISCOUNT_PERCENT" />
                                        </td>

                                        <td>
                                            <div class="AddCustomScroll_Account">
                                                <input type="text" name="ACCOUNT_NAME_BOX"
                                                       ng-model="PRL.ACCOUNT_NAME"
                                                       ng-change="SetAccountValues(Acct,$index)"
                                                       uib-typeahead="Acct.CODE + ' - ' + Acct.NAME  for Acct in INVOICE_XERO_ACCOUNT_CODES | filter:$viewValue"
                                                       typeahead-on-select="ChangeBudget($item, 1, $label)"
                                                       typeahead-loading="loading"
                                                       typeahead-no-results="noResults"
                                                       class="hidden-input" autocomplete="off"
                                                       required
                                                       placeholder="Type to select account name..."
                                                       ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.ACCOUNT_NAME_BOX.$error.required || INVOICE_FORM.submitted && PRL.IS_ACCOUNT_VALID}" />
                                            </div>
                                            <small ng-show="PRL.IS_ACCOUNT_VALID" class="text-danger">Invalid Account Name</small>
                                        </td>
                                        <td>
                                            <span ng-show="DISABLE_FIELD">{{PRL.TAX_RATE_DETAILS}}</span>
                                            <span ng-show="!DISABLE_FIELD">
                                                <select class="hidden-input"
                                                        name="TAX_TYPE{{$index}}"
                                                        ng-model="PRL.TAX_ID"
                                                        ng-style="DISABLE_FIELD==true && {'background':'none','-webkit-appearance':'none','-moz-appearance':'none'}"
                                                        ng-options="XT as XT.NAME +' ('+ XT.RATE +')'  for XT in INVOICE_XERO_TAXES"
                                                        required
                                                        ng-disabled="DISABLE_FIELD"
                                                        ng-change="TAXPERCENTAGE_CHANGE(PRL.TAX_ID,PRL);"
                                                        ng-class="{'error':INVOICE_FORM.submitted && INVOICE_FORM.TAX_TYPE{{$index}}.$error.required}">
                                                    <option value="">- Select Tax -</option>
                                                </select>
                                            </span>
                                        </td>
                                        <td class="text-right text-nowrap pr-2">
                                            {{PRL.TAX_AMOUNT=Invoice_Search.TAX_TYPE==3?0: (Invoice_Search.TAX_TYPE==2?((((PRL.UNIT_PRICE*PRL.QUANTITY) / (1 + (PRL.TAX_ID.RATE/100)))-(((PRL.UNIT_PRICE*PRL.QUANTITY) / (1 + (PRL.TAX_ID.RATE/100)))*(PRL.DISCOUNT_PERCENT/100))) * (PRL.TAX_ID.RATE/100)):(((PRL.UNIT_PRICE*PRL.QUANTITY)-((PRL.UNIT_PRICE*PRL.QUANTITY)*(PRL.DISCOUNT_PERCENT/100))) * (PRL.TAX_ID.RATE/100))) | number:2}}
                                        </td>
                                        <td class="text-right text-nowrap pr-2">
                                            {{PRL.AMOUNT= ((PRL.QUANTITY * PRL.UNIT_PRICE) - (PRL.QUANTITY*1 * PRL.UNIT_PRICE*1 * (PRL.DISCOUNT_PERCENT)/100)) | number:2}}
                                        </td>

                                        <td ng-repeat="TrackingCat in PRL.INVOICE_XERO_TRACKING_CATEGORIES track by $index" ng-init="InitiateInvoiceXeroTrackingCategories(TrackingCat, $index,PRL,1);">
                                            <select class="hidden-input"
                                                    ng-style="DISABLE_FIELD==true && {'background':'none','-webkit-appearance':'none','-moz-appearance':'none'}"
                                                    ng-model="TrackingCat.SELECTED_CATEGORY_OPTION"
                                                    ng-disabled="DISABLE_FIELD"
                                                    ng-options="XT as XT.OPTION_NAME for XT in INVOICE_XERO_TRACKING_CATEGORIES_OPTIONS | filter:{APPROVAL_CHAIN_CUSTOM_FIELDS_MASTER_ID:TrackingCat.APPROVAL_CHAIN_CUSTOM_FIELDS_MASTER_ID}">
                                                <option value="">- Please Select -</option>
                                            </select>
                                        </td>
                                        <td class="text-center">
                                            <i ng-show="!$first && !DISABLE_FIELD" class="far fa-times-circle cursor-pointer text-danger"
                                               ng-click="REMOVE_LINE_ITEM_INVOICE($index,PRL)"
                                               data-toggle="tooltip" data-html="true" data-original-title="Remove">
                                            </i>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td ng-show="!DISABLE_FIELD" colspan="{{INVOICE_XERO_TRACKING_CATEGORIES.length+12}}"
                                            ng-click="ADD_MORE_ITEM_INVOICE()" class="text-center cursor-pointer">
                                            <a class="text-blue cursor-pointer text-sm"><i class="far fa-plus"></i>{{ADD_MORE_ITEM_NAME}}</a>
                                        </td>
                                    </tr>
                                    <tr class="text-bold table-footer-fixed">
                                        <td colspan="9" class="text-right font-13">Sub Total</td>
                                        <td class="text-right text-nowrap pr-2 font-13">{{Invoice_Search.NET_AMOUNT=(INVOICE_ITEM_LIST | total: 'AMOUNT') | number:2}}</td>
                                        <td colspan="{{INVOICE_XERO_TRACKING_CATEGORIES.length+2}}"></td>
                                    </tr>
                                    <tr class="text-bold table-footer-fixed" ng-repeat="TAX in INVOICE_ITEM_LIST | unique:'TAX_ID'" ng-if="TAX.TAX_ID!=null">
                                        <td colspan="9" class="text-right font-13">{{TAX.TAX_ID.NAME}} ({{TAX.TAX_ID.RATE +'%'}})</td>
                                        <td class="text-right text-nowrap pr-2 font-13">{{ INVOICE_ITEM_LIST | filter:{TAX_ID:TAX.TAX_ID} | total:'TAX_AMOUNT' | number:2}}<!--Taxamount=((UnitPrice*Qty)/(1 + Tax%))*tax%--></td>
                                        <td colspan="{{INVOICE_XERO_TRACKING_CATEGORIES.length+2}}"></td>
                                    </tr>
                                    <tr class="text-bold table-footer-fixed">
                                        <td colspan="9" class="text-right font-13">Total</td>
                                        <td class="text-right text-nowrap pr-2 font-14">
                                            <span ng-show="false">
                                                {{Invoice_Search.TAX_AMOUNT= (INVOICE_ITEM_LIST | total:'TAX_AMOUNT') | number:2}}
                                            </span>

                                            <span ng-if="Invoice_Search.TAX_TYPE==1">
                                                {{Invoice_Search.TOTAL_AMOUNT=((INVOICE_ITEM_LIST | total: 'AMOUNT') + (INVOICE_ITEM_LIST | total: 'TAX_AMOUNT')) | number:2}}
                                            </span>
                                            <span ng-if="Invoice_Search.TAX_TYPE==2">
                                                {{Invoice_Search.TOTAL_AMOUNT=(INVOICE_ITEM_LIST | total: 'AMOUNT')  | number:2}}
                                            </span>
                                            <span ng-if="Invoice_Search.TAX_TYPE==3">
                                                {{Invoice_Search.TOTAL_AMOUNT=(INVOICE_ITEM_LIST | total: 'AMOUNT') | number:2}}
                                            </span>
                                            {{(INVOICE_CURRENCY_LIST | filter :{CURRENCY_ID:Invoice_Search.INVOICE_CURRENCY_ID})[0].CURRENCY_CODE }}
                                        </td>
                                        <td colspan="{{INVOICE_XERO_TRACKING_CATEGORIES.length+2}}"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-md-12 border-bottom"></div>
                    </div>

                    <div class="col-md-12">
                        <div class="row mt-3">
                            <div class="card-header w-100" ng-show="P2P_INVOICE_BUDGET_MASTER_LIST.length>0">
                                <h5 class="card-title"> Actual Budget (This shows the current status of Budget) </h5>
                                <button type="button"
                                        ng-click="Fn_ADJUSTMENT_BUDGET(Invoice_Search,1)"
                                        ng-show="false && Invoice_Search.SPLIT_TYPE>0 && (REM_AMOUNT_LEFT>0 || REM_AMOUNT_LEFT<0) "
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    Auto adjust Budget
                                </button>
                                <button type="button"
                                        ng-click="Fn_CANCEL_SPLIT(Invoice_Search,1)"
                                        ng-show="Invoice_Search.SPLIT_TYPE>0"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    Cancel Split
                                </button>
                                <button type="button"
                                        ng-show="false && Invoice_Search.SPLIT_TYPE==null"
                                        ng-click="Fn_SPLIT_REQ(Invoice_Search,1)"
                                        data-toggle="tooltip"
                                        data-html="true"
                                        class="btn btn-transparent-wenodo ml-2 border float-right">
                                    Split Budget
                                </button>
                                <span class="float-right mx-2" ng-show="Invoice_Search.SPLIT_TYPE>0"> Months</span>
                                <select class="custom-select float-right ml-2" style="width:150px;"
                                        name="SPLIT_NAME"
                                        ng-show="Invoice_Search.SPLIT_TYPE>0"
                                        ng-change="Fn_SPLIT_REQ(Invoice_Search,2)"
                                        ng-model="Invoice_Search.SPLIT_TYPE"
                                        ng-options="T.ID as T.NAME for T in SPLIT_TYPE">
                                    <option value="">-Select Month-</option>
                                </select>
                                <span class="float-right" ng-show="Invoice_Search.SPLIT_TYPE>0">Split in Next</span>

                            </div>
                            <div class="col-md-12 mt-2" ng-show="P2P_INVOICE_BUDGET_MASTER_LIST.length>0">
                                <span class="po-amount">The following budgets would be affected by the approval of the Bill.</span>
                            </div>
                            <div class="col-md-12 text-center mt-2" ng-show="P2P_INVOICE_BUDGET_MASTER_LIST.length==0">
                                <div class="alert bg-custom-blue">{{BUDGET_TEXT_VALIDATION}}</div>
                            </div>
                        </div>
                        <table class="table table-head-fixed table-hover" ng-show="P2P_INVOICE_BUDGET_MASTER_LIST.length>0">
                            <thead class="bg-wenodo-border">
                                <tr>
                                    <th>GL Account </th>
                                    <th>Period</th>
                                    <th class="text-right">Total</th>
                                    <th class="text-right">Remaining</th>
                                    <th class="text-right">Consumed</th>
                                    <th class="text-right">Booked</th>
                                    <th class="text-right">Current</th>
                                </tr>
                            </thead>
                            <tbody ng-repeat="BD in P2P_INVOICE_BUDGET_MASTER_LIST">
                                <tr>
                                    <td rowspan="3">{{BD.GLACCOUNT_NAME}}</td>
                                    <td colspan="7" ng-if="BD.DB_ACCOUNT_ID==0" class="text-align-center text-bold">There is no budget allocated in this GL Account</td>
                                </tr>
                                <tr ng-if="BD.DB_ACCOUNT_ID!=0" ng-repeat="BL in BD.BUDGET_DETAILS_LIST"
                                    ng-init="BL.CURRENT_PO_CUSTOM=0;"
                                    ng-click="VIEW_BUDGET_fn(BD,Invoice_Search.BUDGET_DATE,Invoice_Search.PROJECT_MASTER_ID,Invoice_Search,Invoice_Search,'BILL_EDIT_ACTION')">
                                    <td>{{BL.PERIOD}}</td>
                                    <td class="text-right">{{BL.TOTAL | number:2}}</td>
                                    <td class="text-right" ng-class="{'text-red text-bold':BL.REMAINING_AMOUNT<0}">
                                        {{(BL.REMAINING_AMOUNT=((BL.TOTAL*1)-((BL.BOOKED*1) +(BL.CURRENT_PO_CUSTOM*1)+(BL.CONSUMED*1)+(BL.MEMO*1)))) | number:2}}
                                        <span ng-show="false">
                                            {{BD.IS_OVER_BUDGET=(BL.REMAINING_AMOUNT<0 && BD.BUDGET_DETAILS_LIST.length==BL.LINE_ID?true:BD.IS_OVER_BUDGET?true:false)}}
                                        </span>
                                    </td>
                                    <td class="text-right">{{BL.CONSUMED | number :2}}</td>
                                    <td class="text-right">{{BL.BOOKED  | number :2}}</td>
                                    <td class="text-right">
                                        <span ng-show="false">
                                            {{BL.ITEM_TAX_AMOUNT=(INVOICE_ITEM_LIST | filter:{ACCOUNT_ID:BD.ACCOUNT_ID} | total:'TAX_AMOUNT')}}
                                            {{BL.ITEM_AMOUNT= (INVOICE_ITEM_LIST | filter:{ACCOUNT_ID:BD.ACCOUNT_ID} | total:'LINE_AMOUNT') }}
                                            {{BL.TAX_AMT_TOTAL= ((NAN_Fn(BL.ITEM_TAX_AMOUNT)?0:BL.ITEM_TAX_AMOUNT) + BL.ITEM_AMOUNT*1)}}
                                        </span>
                                        {{Invoice_Search.BASE_TO_INVOICE_CONVERSION_RATE}}
                                     

                                        <span> {{(SETTING_USE_GROSS==1?(BL.CURRENT_PO_CUSTOM=Invoice_Search.TAX_TYPE==1 ?(BL.TAX_AMT_TOTAL/Invoice_Search.BASE_TO_INVOICE_CONVERSION_RATE):(BL.ITEM_AMOUNT/Invoice_Search.BASE_TO_INVOICE_CONVERSION_RATE)):BL.CURRENT_PO_CUSTOM=(BL.ITEM_AMOUNT-(Invoice_Search.TAX_TYPE==1?0:BL.ITEM_TAX_AMOUNT)/Invoice_Search.BASE_TO_INVOICE_CONVERSION_RATE)) | number:2}}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="alert alert-warning-red" ng-show="(P2P_INVOICE_BUDGET_MASTER_LIST | filter:{IS_OVER_BUDGET:true}).length">
                            <strong>Warning!</strong> This bill is going over budget.
                        </div>
                    </div>

                    <div class="col-md-6 mt-3 " ng-show="!DISABLE_FIELD">
                        <div class="upload-files-container">
                            <div class="drag-file-area">
                                <label class="label">
                                    <span class="browse-files">
                                        <input type="file" class="default-file-input" id="INVOICE1"
                                               ng-model="Invoice_Search.UploadedFiles"
                                               ng-files="getTheFilesToUpload($files,'INVOICE1',5,Invoice_Search,33,'1','INVOICE',10,'P2P_Upload_Path','P2P')" />
                                        <span class="browse-files-text"><i class="far fa-upload"></i> Add an Attachment</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mt-3" ng-show="!DISABLE_FIELD">
                        <div class="file-block" ng-repeat="file in Invoice_Search.UploadedFiles">
                            <div class="file-info">
                                <i class="far fa-file-alt file-icon"></i>
                                <a href="/P2PFiles/{{file.FILE_PATH}}{{file.SERVER_FILE_NAME}}" download="{{file.ORIGINAL_FILE_NAME}}"> <span class="text-limit-1">{{file.ORIGINAL_FILE_NAME}} </span></a>
                            </div>
                            <span class="remove-file-icon" ng-click="REMOVE_FILTE($index)"><i class="fa fa-times"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>