<style>
    .typing {
        /*font-size: 40px;*/
        font-family: Montserrat;
        white-space: nowrap;
        font-weight: 900;
        margin-left: 10px;
        font-style: normal;
        color: #05a6f0;
        letter-spacing: 3px;
        display: inline-block;
    }

    .dots {
        display: inline-block;
    }

    .dot {
        display: inline-block;
        opacity: 0;
        animation: blink 1.5s infinite;
    }
        .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            animation-delay: 0.3s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.6s;
        }

    @keyframes blink {
        0%, 100% {
            opacity: 0;
        }

        50% {
            opacity: 1;
        }
    }

</style>
<div class="chatbox-container">
    <div id="particles-js"></div>
    <div class="row w-100">
        <div class="col-xxl-8 col-xl-8 col-md-8 mx-auto">
            <div class="card chat_container mb-0">
                <div class="card-body" ng-show="messages.length>0">
                    <div class="row chat-box">
                        <div class="col chat_box_up">
                            <div class="chat">
                                <div class="chat-history chat-msg-box">
                                    <ul>
                                        <li class="clearfix" ng-show="false">
                                            <img class="user_image" src="{{IMAGE_PATH}}" alt="Generic placeholder image">
                                            <div class="message other-message float-end">
                                                <div class="media">
                                                    <div class="media-body align-self-center">
                                                        Well I am not sure. The rest of the team is not here yet. Maybe in an hour or so?
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <!--<li class="clearfix" ng-show="messagess.length>0">
                                            <img class="user_image" src="../../../E_Content/images/User_01.png" alt="">
                                            <div class="message other-message float-end">
                                                <div class="media">
                                                    <div class="media-body align-self-center">
                                                        <div ng-bind-html="assistantResponse | markdown"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>-->
                                        <li class="clearfix" ng-repeat="msg in messages">
                                            <img class="user_image" ng-if="msg.sender=='user'"
                                                 src="{{IMAGE_PATH}}" alt="">
                                            <div class="message other-message float-end" ng-if="msg.sender=='user'">
                                                <div class="media">
                                                    <div class="media-body align-self-center">
                                                        <div ng-bind-html="msg.content | markdown"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="message my-message" ng-if="msg.sender=='assistant'" style="display: flex; align-items: flex-start;">
                                                <img class="we_ai" src="../../../E_Content/images/We_logo.png" alt="">

                                                <div style="flex: 1;">
                                                    <div class="response" ng-bind-html="msg.content | markdown"></div>
                                                    <div ng-if="waiting && $last">
                                                        <span class="typing" id="typingText"></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!--<div class="message my-message" ng-if="msg.sender=='assistant'" ng-show="false">
                                                <img class="we_ai" src="../../../E_Content/images/We_logo.png" alt="">
                                                <div class="response" ng-bind-html="msg.content | markdown"></div>
                                                <div ng-if="waiting && $last">
                                                    <span class="typing" id="typingText"></span>
                                                </div>
                                            </div>-->
                                            <div class="border-bottom mb-2" ng-show="!$first && msg.sender=='assistant'"></div>
                                            <div class="message my-message" ng-if="msg.sender=='assistant' && msg.IMG!=null">
                                                <img class="img-hw-100" src="{{msg.IMG}}" alt="">
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card card-body mb-0 search_column">
                    <div class="col-xxl-12 col-xl-12 col-md-12">
                        <h5 class="f-18" ng-show="messages.length==0">
                            Hi {{User_Name}} , ask me anything about sales
                        </h5>
                        <div class="chatbox_suggessions" ng-show="messages.length==0">
                            <button type="button" class="btn btn-pill btn-light" ng-repeat="_search in SEARCH_KEY_WORD_LIST" ng-click="SEARCH_KEY_BUTTON_Fn(_search)"><i class="fa-light {{_search.icon}} me-2"></i> {{_search.name}}</button>
                        </div>

                        <div class="row">
                            <div class="col-xxl col-xl col-md d-flex">
                                <textarea class='chatbox_textarea mb-0'
                                          ng-model="userInput"
                                          rows='1'
                                          ng-enter="sendToAssistant()"
                                          id="myTextarea"
                                          ng-disabled="waiting"
                                          placeholder="Type something...">
                                </textarea>
                                <button class="btn btn-primary chatbox_fixed_btn" ng-disabled="waiting" ng-click="sendToAssistant()" type="button"><i class="fa-light fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        const $textarea = $('#myTextarea');

        // Function to resize textarea based on content
        function resizeTextarea(el) {
            el.style.height = 'auto'; // Shrink to fit content
            el.style.height = el.scrollHeight + 'px'; // Expand to fit content
        }

        // Detect input and adjust height accordingly
        $textarea.on('input', function () {
            if (this.value.length === 0) {
                // Reset to default height when content is empty
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px'; // To ensure it does not stay stretched after clearing
            } else {
                resizeTextarea(this);
            }
        });

        $textarea.on('keydown', function (e) {
            if (e.key === 'Enter') {
                if (e.shiftKey) {
                    e.preventDefault();

                    // Insert a newline at the cursor position
                    const cursorPos = this.selectionStart;
                    const value = this.value;
                    const newValue = value.substring(0, cursorPos) + '\n' + value.substring(cursorPos);
                    this.value = newValue;

                    // Place the cursor after the new line
                    this.selectionStart = this.selectionEnd = cursorPos + 1;

                    // Resize on Shift+Enter
                    resizeTextarea(this);
                } else {
                    // Prevent default behavior of normal Enter (for form submit or other actions)
                    e.preventDefault();
                    console.log('Enter pressed - submit or send');
                }
            }
        });
    });
</script>
<script src="../../../E_Content/plugins/particles/particles.min.js"></script>
<script src="../../../E_Content/plugins/particles/particles-1.js"></script>
